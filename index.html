<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Style Avenue | Boutique de Mode</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Style Avenue, votre destination mode √† Constantine. D√©couvrez nos collections de v√™tements, accessoires et derni√®res tendances.">
  <meta name="keywords" content="mode, v√™tements, boutique, shopping, tendances, Constantine, Alg√©rie, Style Avenue">
  
  <!-- Open Graph Meta Tags for Social Sharing -->
  <meta property="og:title" content="Style Avenue | Boutique de Mode Premium" />
  <meta property="og:description" content="Explorez les derni√®res collections et trouvez votre style unique avec nos pi√®ces de cr√©ateurs et nos essentiels de garde-robe." />
  <meta property="og:image" content="https://images.unsplash.com/photo-1445205170230-053b83016050?auto=format&fit=crop&q=80&w=2071" />
  <meta property="og:url" content="https://your-shop-domain.com" /> <!-- Replace with your actual domain -->
  <meta property="og:type" content="website" />

  <!-- Favicon (Emoji) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõçÔ∏è</text></svg>">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Three.js for 3D Viewer -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- Google Fonts: Poppins, Oswald, Tajawal (for Arabic) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Oswald:wght@600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --accent-color: #8b5cf6; /* A sophisticated violet */
      --accent-color-dark: #7c3aed;
      --border-color: #e2e8f0;
      --shadow-color-rgb: 0, 0, 0;
    }
    
    html[data-theme='dark'] {
      --bg-primary: #1a202c;
      --bg-secondary: #2d3748;
      --text-primary: #f7fafc;
      --text-secondary: #a0aec0;
      --border-color: #4a5568;
      --shadow-color-rgb: 255, 255, 255;
    }

    body {
      font-family: "Poppins", sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .font-heading {
      font-family: 'Oswald', sans-serif;
    }

    /* Arabic Font Styling */
    html[lang="ar"] body {
        font-family: 'Tajawal', sans-serif;
    }
    html[lang="ar"] .font-heading {
        font-family: 'Tajawal', sans-serif;
        font-weight: 700;
    }
    
    /* RTL adjustments */
    html[dir="rtl"] .original-price {
        margin-left: 0;
        margin-right: 0.5rem;
    }
    html[dir="rtl"] .search-results-container {
        left: auto;
        right: 0;
    }
     html[dir="rtl"] .fa-search {
        right: auto;
        left: 1rem;
    }
     html[dir="rtl"] .fa-chevron-down {
        right: auto;
        left: 1rem;
    }
    html[dir="rtl"] .agent-bubble {
        border-radius: 1rem 1rem 0 1rem;
    }
    html[dir="rtl"] .user-bubble {
        border-radius: 1rem 1rem 1rem 0;
    }


    /* Reusable component styles */
    .bg-primary { background-color: var(--bg-primary); }
    .bg-secondary { background-color: var(--bg-secondary); }
    .text-primary { color: var(--text-primary); }
    .text-secondary { color: var(--text-secondary); }
    .border-color { border-color: var(--border-color); }
    .shadow-custom { box-shadow: 0 4px 6px -1px rgba(var(--shadow-color-rgb), 0.1), 0 2px 4px -1px rgba(var(--shadow-color-rgb), 0.06); }
    .shadow-custom-lg { box-shadow: 0 10px 15px -3px rgba(var(--shadow-color-rgb), 0.1), 0 4px 6px -2px rgba(var(--shadow-color-rgb), 0.05); }
    .shadow-custom-xl { box-shadow: 0 20px 25px -5px rgba(var(--shadow-color-rgb), 0.1), 0 10px 10px -5px rgba(var(--shadow-color-rgb), 0.04); }

    /* Header scroll effect */
    header.scrolled {
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(8px);
    }
    html[data-theme='dark'] header.scrolled {
        background-color: rgba(26, 32, 44, 0.9);
        box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.1);
    }
    
    /* Active Nav Link */
    .nav-link.active {
        color: var(--accent-color);
        position: relative;
    }
    .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: var(--accent-color);
    }

    /* Fade-in animation */
    .fade-in-up {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .fade-in-up.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Parallax effect */
    .parallax {
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }
    
    /* Testimonial Slider */
    #testimonial-slider-container {
      position: relative;
      min-height: 300px; 
    }
    .testimonial-slide {
      opacity: 0;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      transition: opacity 0.5s ease-in-out;
      width: 100%;
    }
    .testimonial-slide.active {
      opacity: 1;
      position: relative;
    }

    /* Form input focus animation */
    .form-input {
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .form-input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }
    
    /* Product filter & card */
    .product-filter-btn.active, .size-filter-btn.active {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    .product-item {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, opacity 0.3s ease-in-out;
    }
    .product-item:hover .product-hover-overlay {
        opacity: 1;
        transform: translateY(0);
    }
    .product-hover-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1rem;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        opacity: 0;
        transform: translateY(100%);
        transition: all 0.3s ease-in-out;
    }

    /* Modal styles */
     #newsletter-modal-overlay, #checkout-modal-overlay, #ai-stylist-modal-overlay, 
     #style-quiz-modal-overlay, #wishlist-modal-overlay, #quick-view-modal-overlay, 
     #live-chat-modal-overlay, #size-guide-modal-overlay, #notify-me-modal-overlay {
        transition: opacity 0.3s ease-in-out;
    }
    #newsletter-modal-box, #checkout-modal-box, #ai-stylist-modal-box, 
    #style-quiz-modal-box, #wishlist-modal-box, #quick-view-modal-box, 
    #live-chat-modal-box, #size-guide-modal-box, #notify-me-modal-box {
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    }

    /* Product Badge */
    .product-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        color: white;
        z-index: 10;
    }
    html[dir="rtl"] .product-badge {
        left: auto;
        right: 1rem;
    }

    /* Out of Stock Style */
    .add-to-cart-btn:disabled, .notify-me-btn {
        background-color: #a0aec0; /* gray-400 */
        cursor: pointer;
    }
    html[data-theme='dark'] .add-to-cart-btn:disabled, html[data-theme='dark'] .notify-me-btn {
        background-color: #4a5568; /* gray-600 */
    }

    /* Social Proof Notification */
    #social-proof {
      transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    }
    
    /* Recently Viewed Section */
    #recently-viewed-container::-webkit-scrollbar {
        height: 8px;
    }
    #recently-viewed-container::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 10px;
    }
    #recently-viewed-container {
        scrollbar-width: thin;
        scrollbar-color: var(--border-color) transparent;
    }
    
    /* 3D Viewer Canvas */
    #d-viewer-container {
        width: 100%;
        height: 400px; /* Adjust height as needed */
        cursor: grab;
    }
     #d-viewer-container:grabbing {
        cursor: grabbing;
    }


    /* Shop the Look */
    .lookbook-item, #home { position: relative; }
    .shop-dot {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: white;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.5);
      animation: pulse 2s infinite;
    }
    .shop-dot:hover {
      animation-play-state: paused;
    }
    .dot-popup {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      padding: 0.75rem;
      border-radius: 0.5rem;
      box-shadow: var(--shadow-custom-lg);
      width: 220px;
      z-index: 20;
      transform: translateY(10px);
    }
    .shop-dot:hover .dot-popup {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    @keyframes pulse {
        0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
        70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
        100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
    }

    /* Wishlist Button */
    .wishlist-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background-color: rgba(255,255,255,0.8);
        color: var(--text-secondary);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        z-index: 10;
    }
     html[dir="rtl"] .wishlist-btn {
        right: auto;
        left: 1rem;
    }
    .wishlist-btn:hover {
        background-color: white;
        transform: scale(1.1);
    }
    .wishlist-btn.active i {
        color: #ef4444; /* red-500 */
        font-weight: 900;
    }

    /* Star Rating */
    .star-rating {
        display: inline-flex;
        color: #f59e0b; /* amber-500 */
    }
    .star-rating .fa-star-half-alt {
        color: #f59e0b;
    }
    .star-rating .far {
        color: #d1d5db; /* gray-300 */
    }
    html[data-theme='dark'] .star-rating .far {
        color: #4b5563; /* gray-600 */
    }

    /* Blog Card */
    .blog-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .blog-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-custom-xl);
    }
    .blog-card:hover .blog-card-image img {
        transform: scale(1.05);
    }
    .blog-card-image img {
        transition: transform 0.3s ease;
    }

    /* Search Autocomplete */
    .search-results-container {
        position: absolute;
        top: calc(100% + 10px);
        left: 0;
        width: 100%;
        max-height: 300px;
        overflow-y: auto;
        background-color: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        box-shadow: var(--shadow-custom-lg);
        z-index: 100;
    }
    .search-result-item {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        transition: background-color 0.2s ease;
        cursor: pointer;
    }
    .search-result-item:hover {
        background-color: var(--bg-secondary);
    }
    .search-result-item + .search-result-item {
        border-top: 1px solid var(--border-color);
    }

    /* Quick Add Button */
    .quick-add-btn {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background-color: rgba(255, 255, 255, 0.9);
        color: var(--accent-color);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        z-index: 10;
        opacity: 0;
        transform: translateY(10px);
    }
     html[dir="rtl"] .quick-add-btn {
        right: auto;
        left: 1rem;
    }
    .product-item:hover .quick-add-btn {
        opacity: 1;
        transform: translateY(0);
    }
    .quick-add-btn:hover {
        background-color: white;
        transform: scale(1.1);
    }

    /* Price Range Slider */
    input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
    }
    input[type=range]:focus {
        outline: none;
    }
    input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: var(--border-color);
        border-radius: 5px;
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: var(--accent-color);
        cursor: pointer;
        margin-top: -6px;
    }

  </style>
</head>
<body class="antialiased">

  <!-- Header -->
  <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="#" class="text-3xl font-heading font-bold text-primary">
        STYLE<span style="color: var(--accent-color);">AVENUE</span>
      </a>
      
      <!-- Desktop Nav -->
      <ul class="hidden md:flex items-center space-x-6">
        <li class="relative">
            <div class="relative">
                <input type="search" id="search-bar" data-translate-placeholder="search_placeholder" placeholder="e.g. robes elegant under 10000" class="form-input w-48 p-2 border border-color rounded-full bg-secondary text-primary transition-all duration-300 focus:w-72" autocomplete="off">
                <i class="fas fa-search absolute top-1/2 right-4 transform -translate-y-1/2 text-secondary"></i>
                <div id="search-results-desktop" class="search-results-container hidden"></div>
            </div>
            <p id="ai-search-feedback" class="absolute top-full left-0 text-xs text-secondary mt-1 h-4"></p>
        </li>
        <li><a href="#about" class="nav-link text-secondary hover:text-violet-500 font-semibold" data-translate-key="nav_about">√Ä Propos</a></li>
        <li><a href="#collections" class="nav-link text-secondary hover:text-violet-500 font-semibold" data-translate-key="nav_collections">Collections</a></li>
        <li><a href="#blog" class="nav-link text-secondary hover:text-violet-500 font-semibold" data-translate-key="nav_journal">Journal</a></li>
        <li><a href="#gallery" class="nav-link text-secondary hover:text-violet-500 font-semibold" data-translate-key="nav_lookbook">Lookbook</a></li>
        <li><a href="#contact" class="nav-link text-secondary hover:text-violet-500 font-semibold" data-translate-key="nav_contact">Contact</a></li>
        <li>
          <button id="wishlist-toggle" class="relative text-secondary hover:text-violet-500">
            <i class="fas fa-heart text-xl"></i>
          </button>
        </li>
        <li>
          <button id="cart-toggle" class="relative text-secondary hover:text-violet-500">
            <i class="fas fa-shopping-bag text-xl"></i>
            <span id="cart-item-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </button>
        </li>
        <li>
            <div class="relative">
                <button id="lang-toggle" class="text-secondary hover:text-violet-500 font-semibold flex items-center"><i class="fas fa-globe mr-1"></i> <span id="current-lang">FR</span></button>
                <div id="lang-menu" class="hidden absolute top-full right-0 mt-2 bg-primary rounded-md shadow-lg border border-color w-24">
                    <a href="#" class="block px-4 py-2 text-sm text-primary hover:bg-secondary" data-lang="fr">Fran√ßais</a>
                    <a href="#" class="block px-4 py-2 text-sm text-primary hover:bg-secondary" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
                </div>
            </div>
        </li>
        <li>
          <button id="theme-toggle" class="text-secondary hover:text-violet-500">
            <i class="fas fa-moon text-xl" id="theme-toggle-dark-icon"></i>
            <i class="fas fa-sun text-xl hidden" id="theme-toggle-light-icon"></i>
          </button>
        </li>
      </ul>
      
      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center space-x-4">
        <button id="wishlist-toggle-mobile" class="text-secondary hover:text-violet-500">
            <i class="fas fa-heart text-xl"></i>
        </button>
        <button id="cart-toggle-mobile" class="relative text-secondary hover:text-violet-500">
          <i class="fas fa-shopping-bag text-xl"></i>
          <span id="cart-item-count-mobile" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
        </button>
        <button id="theme-toggle-mobile" class="text-secondary hover:text-violet-500">
            <i class="fas fa-moon text-xl"></i>
            <i class="fas fa-sun text-xl hidden"></i>
        </button>
        <button id="mobile-menu-btn" class="text-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
      </div>
    </nav>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-primary shadow-custom-lg">
      <div class="p-4 relative">
        <input type="search" id="search-bar-mobile" data-translate-placeholder="search_placeholder_mobile" placeholder="Rechercher..." class="form-input w-full p-2 border border-color rounded-full bg-secondary text-primary" autocomplete="off">
        <div id="search-results-mobile" class="search-results-container hidden w-full"></div>
      </div>
      <a href="#about" class="block py-3 px-6 text-secondary hover:bg-secondary" data-translate-key="nav_about">√Ä Propos</a>
      <a href="#collections" class="block py-3 px-6 text-secondary hover:bg-secondary" data-translate-key="nav_collections">Collections</a>
      <a href="#blog" class="block py-3 px-6 text-secondary hover:bg-secondary" data-translate-key="nav_journal">Journal</a>
      <a href="#gallery" class="block py-3 px-6 text-secondary hover:bg-secondary" data-translate-key="nav_lookbook">Lookbook</a>
      <a href="#contact" class="block py-3 px-6 text-secondary hover:bg-secondary" data-translate-key="nav_contact">Contact</a>
       <div class="p-4 border-t border-color flex justify-center">
            <div class="relative">
                <button id="lang-toggle-mobile" class="text-secondary hover:text-violet-500 font-semibold flex items-center"><i class="fas fa-globe mr-1"></i> <span id="current-lang-mobile">FR</span></button>
                 <div id="lang-menu-mobile" class="hidden absolute bottom-full mb-2 bg-primary rounded-md shadow-lg border border-color w-24">
                    <a href="#" class="block px-4 py-2 text-sm text-primary hover:bg-secondary" data-lang="fr">Fran√ßais</a>
                    <a href="#" class="block px-4 py-2 text-sm text-primary hover:bg-secondary" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
                </div>
            </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero Section -->
    <section id="home" class="h-screen min-h-[700px] flex items-center justify-center text-white bg-cover bg-center parallax" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&q=80&w=2070')">
      <div class="text-center p-6 fade-in-up z-10">
        <h1 class="text-5xl md:text-7xl font-extrabold mb-4 drop-shadow-lg font-heading uppercase" data-translate-key="hero_title">D√âFINISSEZ VOTRE STYLE</h1>
        <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto drop-shadow-md" data-translate-key="hero_subtitle">L'√©l√©gance √† port√©e de main. D√©couvrez les collections qui vous ressemblent.</p>
        <a href="#collections" class="text-white px-8 py-3 rounded-full transition-all transform hover:scale-105 text-lg font-bold shadow-xl uppercase" style="background-color: var(--accent-color); hover:background-color: var(--accent-color-dark);" data-translate-key="hero_cta">Nos Nouveaut√©s</a>
      </div>
      <!-- Shop the Look Dots -->
      <div id="hero-shop-dots" class="hidden md:block">
          <div class="shop-dot" style="top: 40%; left: 35%;">
              <div class="dot-popup" style="left: 30px; top: -50%;"></div>
          </div>
          <div class="shop-dot" style="top: 65%; left: 60%;">
              <div class="dot-popup" style="left: -230px; top: -50%;"></div>
          </div>
      </div>
    </section>

    <!-- About Us Section -->
    <section id="about" class="py-20 bg-primary">
      <div class="container mx-auto px-6">
        <div class="grid md:grid-cols-2 gap-12 items-center">
          <div class="fade-in-up">
            <img loading="lazy" src="https://images.unsplash.com/photo-1523381294911-8d3cead13475?auto=format&fit=crop&q=80&w=2070" alt="Int√©rieur de la boutique Style Avenue" class="rounded-lg shadow-custom-xl w-full h-auto object-cover">
          </div>
          <div class="fade-in-up" style="transition-delay: 150ms;">
            <h2 class="text-4xl font-bold font-heading mb-4 text-primary" data-translate-key="about_title">BIENVENUE CHEZ STYLE AVENUE</h2>
            <p class="text-secondary mb-4 text-lg" data-translate-key="about_p1">
              Style Avenue est plus qu'une boutique, c'est une c√©l√©bration de l'individualit√©. N√©e √† Constantine, notre mission est de proposer des pi√®ces uniques et de haute qualit√© qui permettent √† chacun d'exprimer sa personnalit√©.
            </p>
            <p class="text-secondary mb-6 text-lg" data-translate-key="about_p2">
             Nous s√©lectionnons avec soin chaque article pour son design, sa coupe et ses mati√®res durables. Notre √©quipe de passionn√©s est l√† pour vous offrir des conseils personnalis√©s et une exp√©rience shopping inoubliable.
            </p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Featured Products Section -->
    <section id="collections" class="py-20 bg-secondary">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-4xl font-bold font-heading mb-4 text-primary" data-translate-key="collections_title">NOS NOUVEAUT√âS</h2>
                <p class="text-secondary max-w-2xl mx-auto" data-translate-key="collections_subtitle">D√©couvrez une s√©lection de nos pi√®ces les plus r√©centes.</p>
            </div>

            <!-- Filters and Sorting Controls -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 fade-in-up">
                <div id="product-filters" class="flex justify-center flex-wrap gap-2 md:space-x-4 mb-4 md:mb-0">
                    <button class="product-filter-btn active px-4 py-2 font-semibold rounded-full transition bg-primary text-primary" data-filter="all" data-translate-key="filter_all">Tous</button>
                    <button class="product-filter-btn px-4 py-2 font-semibold rounded-full transition bg-primary text-primary" data-filter="dresses" data-translate-key="filter_dresses">Robes</button>
                    <button class="product-filter-btn px-4 py-2 font-semibold rounded-full transition bg-primary text-primary" data-filter="tops" data-translate-key="filter_tops">Hauts</button>
                    <button class="product-filter-btn px-4 py-2 font-semibold rounded-full transition bg-primary text-primary" data-filter="pants" data-translate-key="filter_pants">Pantalons</button>
                    <button class="product-filter-btn px-4 py-2 font-semibold rounded-full transition bg-primary text-primary" data-filter="accessories" data-translate-key="filter_accessories">Accessoires</button>
                </div>
                <div class="relative">
                    <select id="product-sort" class="form-input appearance-none w-48 p-2 pr-8 border border-color rounded-full bg-primary text-primary">
                        <option value="default" data-translate-key="sort_default">Trier par</option>
                        <option value="price-asc" data-translate-key="sort_price_asc">Prix: Croissant</option>
                        <option value="price-desc" data-translate-key="sort_price_desc">Prix: D√©croissant</option>
                        <option value="name-asc" data-translate-key="sort_name_asc">Nom: A-Z</option>
                    </select>
                    <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-secondary pointer-events-none"></i>
                </div>
            </div>

            <!-- Advanced Filters -->
             <div class="mb-12 p-6 bg-primary rounded-lg shadow-custom fade-in-up">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="price-range" class="block text-sm font-semibold text-primary mb-2">Gamme de prix</label>
                        <input type="range" id="price-range" min="3000" max="20000" step="100" value="20000" class="w-full">
                        <div class="flex justify-between text-xs text-secondary mt-1">
                            <span>3000 DZD</span>
                            <span id="price-range-value">20000 DZD</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-primary mb-2">Taille</label>
                        <div id="size-filters" class="flex flex-wrap gap-2">
                            <button class="size-filter-btn px-3 py-1 border border-color rounded-full text-sm" data-size="S">S</button>
                            <button class="size-filter-btn px-3 py-1 border border-color rounded-full text-sm" data-size="M">M</button>
                            <button class="size-filter-btn px-3 py-1 border border-color rounded-full text-sm" data-size="L">L</button>
                            <button class="size-filter-btn px-3 py-1 border border-color rounded-full text-sm" data-size="XL">XL</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-primary mb-2">Disponibilit√©</label>
                         <div class="flex items-center">
                            <input type="checkbox" id="in-stock-filter" class="h-4 w-4 rounded" style="color: var(--accent-color)">
                            <label for="in-stock-filter" class="ml-2 text-sm text-secondary">En stock uniquement</label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 fade-in-up">
                <!-- Products will be dynamically injected here by JavaScript -->
            </div>
        </div>
    </section>
    
    <!-- Style Quiz CTA Section -->
    <section id="style-quiz-cta-section" class="py-20 parallax text-white" style="background-image: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1552664199-fd31f7431a55?auto=format&fit=crop&q=80&w=2070');">
        <div class="container mx-auto px-6 text-center fade-in-up">
            <h2 class="text-4xl font-bold font-heading mb-4" data-translate-key="quiz_title">PAS S√õR DE VOTRE STYLE ?</h2>
            <p class="text-gray-300 max-w-2xl mx-auto mb-8" data-translate-key="quiz_subtitle">R√©pondez √† notre quiz rapide et d√©couvrez la collection parfaite pour vous.</p>
            <button id="style-quiz-cta" class="text-white px-8 py-3 rounded-full transition-all transform hover:scale-105 text-lg font-bold shadow-xl uppercase" style="background-color: var(--accent-color);" data-translate-key="quiz_cta">Commencez le Quiz</button>
        </div>
    </section>
    
    <!-- Blog Section -->
    <section id="blog" class="py-20 bg-primary">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16 fade-in-up">
                <h2 class="text-4xl font-bold font-heading mb-4 text-primary" data-translate-key="blog_title">LE JOURNAL</h2>
                <p class="text-secondary max-w-2xl mx-auto" data-translate-key="blog_subtitle">Conseils de style, tendances et inspirations de notre √©quipe.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-8 fade-in-up">
                <!-- Blog Post 1 -->
                <div class="blog-card bg-secondary rounded-lg shadow-custom-lg overflow-hidden">
                    <a href="#" class="block">
                        <div class="blog-card-image overflow-hidden h-64">
                            <img src="https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?auto=format&fit=crop&q=80&w=800" alt="Man in stylish autumn wear" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6">
                            <p class="text-sm text-secondary mb-2" data-translate-key="blog1_meta">1 Octobre 2025 ¬∑ Tendances</p>
                            <h3 class="text-xl font-bold font-heading text-primary mb-3" data-translate-key="blog1_title">Les 5 Tendances Incontournables de l'Automne √† Alger</h3>
                            <p class="text-secondary mb-4" data-translate-key="blog1_excerpt">D√©couvrez comment adopter les couleurs et les mati√®res phares de la saison...</p>
                            <span class="font-semibold" style="color: var(--accent-color);" data-translate-key="read_more">Lire la suite &rarr;</span>
                        </div>
                    </a>
                </div>
                <!-- Blog Post 2 -->
                <div class="blog-card bg-secondary rounded-lg shadow-custom-lg overflow-hidden">
                     <a href="#" class="block">
                        <div class="blog-card-image overflow-hidden h-64">
                            <img src="https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&q=80&w=800" alt="Various stylish outfits" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6">
                            <p class="text-sm text-secondary mb-2" data-translate-key="blog2_meta">25 Septembre 2025 ¬∑ Conseils</p>
                            <h3 class="text-xl font-bold font-heading text-primary mb-3" data-translate-key="blog2_title">Comment Construire une Garde-Robe Capsule</h3>
                            <p class="text-secondary mb-4" data-translate-key="blog2_excerpt">Nos astuces pour s√©lectionner des pi√®ces polyvalentes et intemporelles...</p>
                             <span class="font-semibold" style="color: var(--accent-color);" data-translate-key="read_more">Lire la suite &rarr;</span>
                        </div>
                    </a>
                </div>
                <!-- Blog Post 3 -->
                <div class="blog-card bg-secondary rounded-lg shadow-custom-lg overflow-hidden">
                     <a href="#" class="block">
                        <div class="blog-card-image overflow-hidden h-64">
                           <img src="https://images.unsplash.com/photo-1594223274512-ad4803739b7c?auto=format&fit=crop&q=80&w=800" alt="Woman posing in a beautiful dress" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6">
                            <p class="text-sm text-secondary mb-2" data-translate-key="blog3_meta">18 Septembre 2025 ¬∑ Inspiration</p>
                            <h3 class="text-xl font-bold font-heading text-primary mb-3" data-translate-key="blog3_title">La Robe Parfaite pour Chaque Occasion</h3>
                            <p class="text-secondary mb-4" data-translate-key="blog3_excerpt">Du bureau au d√Æner, trouvez la coupe qui vous mettra en valeur...</p>
                             <span class="font-semibold" style="color: var(--accent-color);" data-translate-key="read_more">Lire la suite &rarr;</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="py-20 bg-secondary">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16 fade-in-up">
                <h2 class="text-4xl font-bold font-heading mb-4 text-primary" data-translate-key="lookbook_title">NOTRE LOOKBOOK</h2>
                <p class="text-secondary max-w-2xl mx-auto" data-translate-key="lookbook_subtitle">Inspirez-vous de nos tenues et cr√©ez votre propre style.</p>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 fade-in-up">
                <div class="lookbook-item overflow-hidden rounded-lg shadow-lg">
                    <img src="https://images.unsplash.com/photo-1529139574466-a303027c1d8b?auto=format&fit=crop&q=80&w=800" alt="Lookbook 1" class="gallery-item w-full h-full object-cover transition-transform duration-300 hover:scale-110 cursor-pointer">
                    <div class="shop-dot" style="top: 30%; left: 60%;">
                        <div class="dot-popup" style="left: -230px; top: -50%;"></div>
                    </div>
                     <div class="shop-dot" style="top: 75%; left: 50%;">
                        <div class="dot-popup" style="left: 30px; top: -50%;"></div>
                    </div>
                </div>
                <div class="overflow-hidden rounded-lg shadow-lg">
                    <img src="https://images.unsplash.com/photo-1509631179647-0177331693ae?auto=format&fit=crop&q=80&w=800" alt="Lookbook 2" class="gallery-item w-full h-full object-cover transition-transform duration-300 hover:scale-110 cursor-pointer">
                </div>
                <div class="overflow-hidden rounded-lg shadow-lg">
                    <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?auto=format&fit=crop&q=80&w=800" alt="Lookbook 3" class="gallery-item w-full h-full object-cover transition-transform duration-300 hover:scale-110 cursor-pointer">
                </div>
                 <div class="overflow-hidden rounded-lg shadow-lg">
                    <img src="https://images.unsplash.com/photo-1492707892479-7bc8d5a4ee93?auto=format&fit=crop&q=80&w=800" alt="Lookbook 4" class="gallery-item w-full h-full object-cover transition-transform duration-300 hover:scale-110 cursor-pointer">
                </div>
            </div>
        </div>
    </section>

    <!-- Recently Viewed Section -->
    <section id="recently-viewed-section" class="py-20 bg-primary hidden">
        <div class="container mx-auto px-6">
            <div class="mb-12 fade-in-up">
                <h2 class="text-3xl font-bold font-heading mb-4 text-primary" data-translate-key="recently_viewed_title">R√âCEMMENT CONSULT√âS</h2>
            </div>
            <div id="recently-viewed-container" class="flex gap-8 overflow-x-auto pb-4">
                <!-- Recently viewed products will be injected here -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials" class="py-20 parallax" style="background-image: linear-gradient(rgba(255, 255, 255, 0.92), rgba(255, 255, 255, 0.92)), url('https://images.unsplash.com/photo-1485230895905-ec40ba36b9bc?auto=format&fit=crop&q=80&w=2070');">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-4xl font-bold font-heading mb-4 fade-in-up text-primary" data-translate-key="testimonials_title">NOS CLIENTES ADORENT</h2>
        <p class="text-secondary mb-12 max-w-2xl mx-auto fade-in-up" data-translate-key="testimonials_subtitle">D√©couvrez les t√©moignages de notre communaut√©.</p>
        
        <div class="relative max-w-3xl mx-auto bg-primary p-8 rounded-lg shadow-custom-xl fade-in-up">
          <div id="testimonial-slider-container">
            <div class="testimonial-slide active">
              <img loading="lazy" src="https://images.unsplash.com/photo-1580489944761-15a19d654956?auto=format&fit=crop&q=80&w=200&h=200" alt="Photo de Amira K." class="w-24 h-24 rounded-full mx-auto mb-6 border-4 object-cover" style="border-color: var(--accent-color);">
              <p class="text-secondary italic text-lg mb-6" data-translate-key="testimonial1_text">"J'ai enfin trouv√© une boutique avec des pi√®ces originales et de qualit√©. Ma nouvelle robe est magnifique, je n'ai que des compliments !"</p>
              <p class="font-bold text-primary text-xl">- Amira K.</p>
            </div>
            <div class="testimonial-slide">
              <img loading="lazy" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&q=80&w=200&h=200" alt="Photo de Sarah L." class="w-24 h-24 rounded-full mx-auto mb-6 border-4 object-cover" style="border-color: var(--accent-color);">
              <p class="text-secondary italic text-lg mb-6" data-translate-key="testimonial2_text">"Le service client est incroyable. J'ai √©t√© conseill√©e par t√©l√©phone et la vendeuse a √©t√© adorable et de tr√®s bon conseil. Livraison ultra rapide."</p>
              <p class="font-bold text-primary text-xl">- Sarah L.</p>
            </div>
          </div>
          <button class="testimonial-prev absolute top-1/2 left-0 md:-left-12 transform -translate-y-1/2 bg-secondary/50 hover:bg-secondary text-primary p-3 rounded-full shadow-md transition">
              <i class="fas fa-chevron-left"></i>
          </button>
          <button class="testimonial-next absolute top-1/2 right-0 md:-right-12 transform -translate-y-1/2 bg-secondary/50 hover:bg-secondary text-primary p-3 rounded-full shadow-md transition">
              <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-20 bg-primary">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12 fade-in-up">
                <h2 class="text-4xl font-bold font-heading mb-4 text-primary" data-translate-key="contact_title">CONTACTEZ-NOUS</h2>
                <p class="text-secondary max-w-xl mx-auto" data-translate-key="contact_subtitle">Une question ? Envoyez-nous un message ou passez nous voir en boutique !</p>
            </div>

            <div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-12 bg-secondary p-8 rounded-lg shadow-custom-lg">
                <!-- Contact Form & Info -->
                <div class="fade-in-up">
                  <form id="contact-form" action="#" method="POST" >
                      <div class="mb-4">
                          <label for="name" class="block text-primary font-semibold mb-2" data-translate-key="form_name">Nom Complet</label>
                          <input type="text" id="name" name="name" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-primary text-primary" required>
                      </div>
                      <div class="mb-4">
                          <label for="email" class="block text-primary font-semibold mb-2" data-translate-key="form_email">Email</label>
                          <input type="email" id="email" name="email" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-primary text-primary" required>
                      </div>
                      <div class="mb-6">
                          <label for="message" class="block text-primary font-semibold mb-2" data-translate-key="form_message">Votre Message</label>
                          <textarea id="message" name="message" rows="5" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-primary text-primary" required data-translate-placeholder="form_message_placeholder" placeholder="J'aimerais avoir plus d'informations sur la robe florale..."></textarea>
                      </div>
                      <button type="submit" class="w-full text-white p-3 rounded-full font-bold text-lg transition flex items-center justify-center space-x-2" style="background-color: var(--accent-color); hover:background-color: var(--accent-color-dark);">
                          <span data-translate-key="form_send">Envoyer</span>
                      </button>
                      <div id="form-status" class="mt-4 text-center"></div>
                  </form>
                   <div class="mt-12">
                     <h3 class="text-2xl font-bold mb-4 text-primary" data-translate-key="contact_info_title">Nos Coordonn√©es</h3>
                      <div class="space-y-6">
                          <div class="flex items-center">
                              <div class="bg-primary p-3 rounded-full mr-4 shadow-custom-sm">
                                  <i class="fas fa-map-marker-alt text-2xl" style="color: var(--accent-color);"></i>
                              </div>
                              <div>
                                <p class="font-bold text-primary" data-translate-key="address_label">Adresse</p>
                                <p class="text-secondary">78 Boulevard de la Mode, Constantine, Alg√©rie</p>
                              </div>
                          </div>
                          <div class="flex items-center">
                              <div class="bg-primary p-3 rounded-full mr-4 shadow-custom-sm">
                                  <i class="fas fa-phone text-2xl" style="color: var(--accent-color);"></i>
                              </div>
                              <div>
                                <p class="font-bold text-primary" data-translate-key="phone_label">T√©l√©phone</p>
                                <p class="text-secondary">+213 555 111 222</p>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
                
                <!-- Google Map -->
                <div class="fade-in-up" style="transition-delay: 200ms; min-height: 400px;">
                  <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d103243.51817812921!2d6.551322386352934!3d36.34091515281896!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12f1db535a265b79%3A0x285923a634125c14!2sConstantine!5e0!3m2!1sfr!2sdz!4v1678886543210!5m2!1sfr!2sdz" 
                    width="100%" height="100%" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                    title="Carte de Style Avenue √† Constantine">
                  </iframe>
                </div>
            </div>
        </div>
    </section>
  </main>
  
  <!-- Footer -->
  <footer class="bg-gray-800 text-white">
      <div class="container mx-auto px-6 py-8 text-center">
          <div class="flex justify-center space-x-6 mb-4">
            <a href="mailto:contact@styleavenue.com" aria-label="Email" class="text-gray-400 hover:text-violet-400 transition-colors duration-300">
              <i class="fas fa-envelope text-2xl"></i>
            </a>
            <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-gray-400 hover:text-violet-400 transition-colors duration-300">
              <i class="fab fa-instagram text-2xl"></i>
            </a>
            <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="text-gray-400 hover:text-violet-400 transition-colors duration-300">
              <i class="fab fa-facebook text-2xl"></i>
            </a>
          </div>
          <p class="text-gray-500" data-translate-key="footer_rights">&copy; 2025 Style Avenue. Tous droits r√©serv√©s.</p>
      </div>
  </footer>
  
  <!-- Back to Top Button -->
  <button id="back-to-top" class="hidden fixed bottom-24 right-5 w-12 h-12 rounded-full shadow-lg focus:outline-none transition-opacity duration-300 z-50 text-white" style="background-color: var(--accent-color);">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Floating Contact Buttons -->
  <div class="fixed bottom-5 right-5 z-50 flex flex-col space-y-3">
    <a href="https://wa.me/213555111222" target="_blank" rel="noopener noreferrer" class="w-14 h-14 bg-green-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-green-600 transition-transform transform hover:scale-110" aria-label="Contactez-nous sur WhatsApp">
      <i class="fab fa-whatsapp text-3xl"></i>
    </a>
  </div>

  <!-- Floating Action Buttons (Left) -->
  <div class="fixed bottom-5 left-5 z-50 flex flex-col space-y-3">
    <!-- Live Chat Floating Button -->
    <button id="live-chat-cta" class="w-14 h-14 rounded-full shadow-lg focus:outline-none transition-transform transform hover:scale-110 text-white flex items-center justify-center bg-blue-500 hover:bg-blue-600" aria-label="Open Live Chat">
      <i class="fas fa-comment-dots text-2xl"></i>
    </button>
    <!-- AI Stylist Floating Button -->
    <button id="ai-stylist-cta" class="w-14 h-14 rounded-full shadow-lg focus:outline-none transition-transform transform hover:scale-110 text-white flex items-center justify-center" style="background-color: var(--accent-color);">
        <i class="fas fa-robot text-2xl"></i>
    </button>
  </div>
  
  <!-- Social Proof Notification -->
  <div id="social-proof" class="hidden fixed bottom-24 md:bottom-5 left-5 right-5 md:left-24 md:right-auto bg-primary text-primary p-4 rounded-lg shadow-custom-lg transform translate-y-20 opacity-0 z-50 max-w-sm"></div>

  <!-- Gallery Lightbox -->
    <div id="lightbox" class="fixed inset-0 bg-black/80 flex items-center justify-center opacity-0 pointer-events-none z-[100]">
        <button id="lightbox-close" class="absolute top-5 right-5 text-white text-3xl">&times;</button>
        <img id="lightbox-img" src="" alt="Vue agrandie de la galerie" class="max-w-[90%] max-h-[80%] object-contain rounded-lg">
    </div>
    
  <!-- All Modals and Sidebars will be injected here -->
    <div id="shopping-cart-sidebar"></div>
    <div id="modals-container"></div>
    <input type="file" id="ai-stylist-image-upload" class="hidden" accept="image/*">


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // --- Central Product Data Store ---
      const allProducts = [
        { id: 'P001', name: "Robe d'√ât√© Florale", category: 'dresses', style: 'elegant', price: 8500, salePrice: 7500, stock: 15, image: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?auto=format&fit=crop&q=80&w=800', badge: { text: 'Nouveau', color: 'bg-pink-500' }, rating: 4.5, reviews: [ { author: 'Fatima Z.', rating: 5, text: 'Magnifique robe, tissu l√©ger et parfait pour l\'√©t√© !' }, { author: 'Amine B.', rating: 4, text: 'Tr√®s jolie, mais taille un peu grand.' } ], sizes: ['S', 'M', 'L'] },
        { id: 'P002', name: "Blouse en Soie", category: 'tops', style: 'elegant', price: 6200, salePrice: null, stock: 8, image: 'https://i.postimg.cc/x163nRwm/LHHHHH.png', badge: { text: 'Top Vente', color: 'bg-yellow-500' }, rating: 5, reviews: [ { author: 'Sarah L.', rating: 5, text: 'Qualit√© exceptionnelle, tr√®s agr√©able √† porter.' } ], sizes: ['S', 'M'] },
        { id: 'P003', name: "Jean Skinny Brut", category: 'pants', style: 'casual', price: 7800, salePrice: null, stock: 25, image: 'https://images.unsplash.com/photo-1604176354204-9268737828e4?auto=format&fit=crop&q=80&w=800', badge: null, rating: 4, reviews: [ { author: 'Karim D.', rating: 4, text: 'Bon jean, confortable.' } ], sizes: ['M', 'L', 'XL'] },
        { id: 'P004', name: "Montre √âl√©gante Dor√©e", category: 'accessories', style: 'elegant', price: 12000, salePrice: null, stock: 5, image: 'https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&q=80&w=800', badge: null, rating: 4.8, reviews: [ { author: 'Nadia K.', rating: 5, text: 'Encore plus belle en vrai, je recommande !' } ], sizes: ['Unique'] },
        { id: 'P005', name: "Robe de Soir√©e Noire", category: 'dresses', style: 'elegant', price: 15500, salePrice: null, stock: 30, image: 'https://images.unsplash.com/photo-1503342217505-b0a15ec3261c?auto=format&fit=crop&q=80&w=800', badge: null, rating: 4.7, reviews: [], sizes: ['S', 'M', 'L'] },
        { id: 'P006', name: "T-shirt en Coton Bio", category: 'tops', style: 'casual', price: 3500, salePrice: null, stock: 0, image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&q=80&w=800', badge: null, rating: 4.2, reviews: [], sizes: ['S', 'M', 'L', 'XL'] },
      ];

      const header = document.getElementById("header");
      const mobileMenuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenu = document.getElementById("mobile-menu");
      const backToTopBtn = document.getElementById('back-to-top');
      let current3DAnimationId = null; // To control the 3D animation loop

      // --- Multi-Language Support ---
      const translations = {
        fr: {
            nav_about: "√Ä Propos",
            nav_collections: "Collections",
            nav_journal: "Journal",
            nav_lookbook: "Lookbook",
            nav_contact: "Contact",
            search_placeholder: "e.g. robes elegant under 10000",
            search_placeholder_mobile: "Rechercher...",
            hero_title: "D√âFINISSEZ VOTRE STYLE",
            hero_subtitle: "L'√©l√©gance √† port√©e de main. D√©couvrez les collections qui vous ressemblent.",
            hero_cta: "Nos Nouveaut√©s",
            about_title: "BIENVENUE CHEZ STYLE AVENUE",
            about_p1: "Style Avenue est plus qu'une boutique, c'est une c√©l√©bration de l'individualit√©. N√©e √† Constantine, notre mission est de proposer des pi√®ces uniques et de haute qualit√© qui permettent √† chacun d'exprimer sa personnalit√©.",
            about_p2: "Nous s√©lectionnons avec soin chaque article pour son design, sa coupe et ses mati√®res durables. Notre √©quipe de passionn√©s est l√† pour vous offrir des conseils personnalis√©s et une exp√©rience shopping inoubliable.",
            collections_title: "NOS NOUVEAUT√âS",
            collections_subtitle: "D√©couvrez une s√©lection de nos pi√®ces les plus r√©centes.",
            filter_all: "Tous",
            filter_dresses: "Robes",
            filter_tops: "Hauts",
            filter_pants: "Pantalons",
            filter_accessories: "Accessoires",
            sort_default: "Trier par",
            sort_price_asc: "Prix: Croissant",
            sort_price_desc: "Prix: D√©croissant",
            sort_name_asc: "Nom: A-Z",
            quiz_title: "PAS S√õR DE VOTRE STYLE ?",
            quiz_subtitle: "R√©pondez √† notre quiz rapide et d√©couvrez la collection parfaite pour vous.",
            quiz_cta: "Commencez le Quiz",
            blog_title: "LE JOURNAL",
            blog_subtitle: "Conseils de style, tendances et inspirations de notre √©quipe.",
            blog1_meta: "1 Octobre 2025 ¬∑ Tendances",
            blog1_title: "Les 5 Tendances Incontournables de l'Automne √† Alger",
            blog1_excerpt: "D√©couvrez comment adopter les couleurs et les mati√®res phares de la saison...",
            blog2_meta: "25 Septembre 2025 ¬∑ Conseils",
            blog2_title: "Comment Construire une Garde-Robe Capsule",
            blog2_excerpt: "Nos astuces pour s√©lectionner des pi√®ces polyvalentes et intemporelles...",
            blog3_meta: "18 Septembre 2025 ¬∑ Inspiration",
            blog3_title: "La Robe Parfaite pour Chaque Occasion",
            blog3_excerpt: "Du bureau au d√Æner, trouvez la coupe qui vous mettra en valeur...",
            read_more: "Lire la suite ‚Üí",
            lookbook_title: "NOTRE LOOKBOOK",
            lookbook_subtitle: "Inspirez-vous de nos tenues et cr√©ez votre propre style.",
            recently_viewed_title: "R√âCEMMENT CONSULT√âS",
            testimonials_title: "NOS CLIENTES ADORENT",
            testimonials_subtitle: "D√©couvrez les t√©moignages de notre communaut√©.",
            testimonial1_text: "\"J'ai enfin trouv√© une boutique avec des pi√®ces originales et de qualit√©. Ma nouvelle robe est magnifique, je n'ai que des compliments !\"",
            testimonial2_text: "\"Le service client est incroyable. J'ai √©t√© conseill√©e par t√©l√©phone et la vendeuse a √©t√© adorable et de tr√®s bon conseil. Livraison ultra rapide.\"",
            contact_title: "CONTACTEZ-NOUS",
            contact_subtitle: "Une question ? Envoyez-nous un message ou passez nous voir en boutique !",
            form_name: "Nom Complet",
            form_email: "Email",
            form_message: "Votre Message",
            form_message_placeholder: "J'aimerais avoir plus d'informations sur la robe florale...",
            form_send: "Envoyer",
            contact_info_title: "Nos Coordonn√©es",
            address_label: "Adresse",
            phone_label: "T√©l√©phone",
            footer_rights: "¬© 2025 Style Avenue. Tous droits r√©serv√©s.",
            // ... Add more keys as needed
        },
        ar: {
            nav_about: "ŸÖŸÜ ŸÜÿ≠ŸÜ",
            nav_collections: "ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™",
            nav_journal: "ÿßŸÑŸÖÿ¨ŸÑÿ©",
            nav_lookbook: "ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ•ÿ∑ŸÑÿßŸÑÿßÿ™",
            nav_contact: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
            search_placeholder: "ŸÖÿ´ÿßŸÑ: ŸÅÿ≥ÿßÿ™ŸäŸÜ ÿ£ŸÜŸäŸÇÿ© ÿ£ŸÇŸÑ ŸÖŸÜ 10000",
            search_placeholder_mobile: "ÿ®ÿ≠ÿ´...",
            hero_title: "ÿ≠ÿØÿØŸä ÿ£ÿ≥ŸÑŸàÿ®ŸÉ",
            hero_subtitle: "ÿßŸÑÿ£ŸÜÿßŸÇÿ© ŸÅŸä ŸÖÿ™ŸÜÿßŸàŸÑ ŸäÿØŸÉ. ÿßŸÉÿ™ÿ¥ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ¥ÿ®ŸáŸÉ.",
            hero_cta: "ÿ¨ÿØŸäÿØŸÜÿß",
            about_title: "ŸÖÿ±ÿ≠ÿ®Ÿãÿß ÿ®ŸÉŸÖ ŸÅŸä ÿ≥ÿ™ÿßŸäŸÑ ÿ£ŸÅŸÜŸäŸà",
            about_p1: "ÿ≥ÿ™ÿßŸäŸÑ ÿ£ŸÅŸÜŸäŸà ŸáŸà ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ŸÖÿ¨ÿ±ÿØ ÿ®Ÿàÿ™ŸäŸÉÿå ÿ•ŸÜŸá ÿßÿ≠ÿ™ŸÅÿßŸÑ ÿ®ÿßŸÑŸÅÿ±ÿØŸäÿ©. ŸàŸèŸÑÿØ ŸÅŸä ŸÇÿ≥ŸÜÿ∑ŸäŸÜÿ©ÿå ŸàŸÖŸáŸÖÿ™ŸÜÿß ŸáŸä ÿ™ŸÇÿØŸäŸÖ ŸÇÿ∑ÿπ ŸÅÿ±ŸäÿØÿ© ŸàÿπÿßŸÑŸäÿ© ÿßŸÑÿ¨ŸàÿØÿ© ÿ™ÿ≥ŸÖÿ≠ ŸÑŸÑÿ¨ŸÖŸäÿπ ÿ®ÿßŸÑÿ™ÿπÿ®Ÿäÿ± ÿπŸÜ ÿ¥ÿÆÿµŸäÿ™ŸáŸÖ.",
            about_p2: "ŸÜÿÆÿ™ÿßÿ± ŸÉŸÑ ŸÇÿ∑ÿπÿ© ÿ®ÿπŸÜÿßŸäÿ© ŸÑÿ™ÿµŸÖŸäŸÖŸáÿß ŸàŸÇÿµÿ™Ÿáÿß ŸàŸÖŸàÿßÿØŸáÿß ÿßŸÑŸÖÿ≥ÿ™ÿØÿßŸÖÿ©. ŸÅÿ±ŸäŸÇŸÜÿß ÿßŸÑÿ¥ÿ∫ŸàŸÅ ŸáŸÜÿß ŸÑŸäŸÇÿØŸÖ ŸÑŸÉŸÖ ŸÜÿµÿßÿ¶ÿ≠ ÿ¥ÿÆÿµŸäÿ© Ÿàÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿ≥ŸàŸÇ ŸÑÿß ÿ™ŸèŸÜÿ≥Ÿâ.",
            collections_title: "ÿ¨ÿØŸäÿØŸÜÿß",
            collections_subtitle: "ÿßŸÉÿ™ÿ¥ŸÅŸàÿß ÿ™ÿ¥ŸÉŸäŸÑÿ© ŸÖŸÜ ÿ£ÿ≠ÿØÿ´ ŸÇÿ∑ÿπŸÜÿß.",
            filter_all: "ÿßŸÑŸÉŸÑ",
            filter_dresses: "ŸÅÿ≥ÿßÿ™ŸäŸÜ",
            filter_tops: "ÿ®ŸÑŸàÿ≤ÿßÿ™",
            filter_pants: "ÿ≥ÿ±ÿßŸàŸäŸÑ",
            filter_accessories: "ÿ•ŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™",
            sort_default: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ®",
            sort_price_asc: "ÿßŸÑÿ≥ÿπÿ±: ŸÖŸÜ ÿßŸÑÿ£ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ£ÿπŸÑŸâ",
            sort_price_desc: "ÿßŸÑÿ≥ÿπÿ±: ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâ ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ",
            sort_name_asc: "ÿßŸÑÿßÿ≥ŸÖ: ÿ£-Ÿä",
            quiz_title: "ŸÑÿ≥ÿ™ ŸÖÿ™ÿ£ŸÉÿØÿ© ŸÖŸÜ ÿ£ÿ≥ŸÑŸàÿ®ŸÉÿü",
            quiz_subtitle: "ÿ£ÿ¨Ÿäÿ®Ÿä ÿπŸÑŸâ ÿßÿÆÿ™ÿ®ÿßÿ±ŸÜÿß ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸàÿßŸÉÿ™ÿ¥ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÖÿ´ÿßŸÑŸäÿ© ŸÑŸÉ.",
            quiz_cta: "ÿßÿ®ÿØÿ¶Ÿä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±",
            blog_title: "ÿßŸÑŸÖÿ¨ŸÑÿ©",
            blog_subtitle: "ŸÜÿµÿßÿ¶ÿ≠ ŸÅŸä ÿßŸÑÿ£ŸÜÿßŸÇÿ©ÿå ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿµŸäÿ≠ÿßÿ™ Ÿàÿ•ŸÑŸáÿßŸÖÿßÿ™ ŸÖŸÜ ŸÅÿ±ŸäŸÇŸÜÿß.",
            blog1_meta: "1 ÿ£ŸÉÿ™Ÿàÿ®ÿ± 2025 ¬∑ ÿµŸäÿ≠ÿßÿ™",
            blog1_title: "ÿ£ŸáŸÖ 5 ÿµŸäÿ≠ÿßÿ™ ŸÑÿÆÿ±ŸäŸÅ ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±",
            blog1_excerpt: "ÿßŸÉÿ™ÿ¥ŸÅŸä ŸÉŸäŸÅŸäÿ© ÿßÿπÿ™ŸÖÿßÿØ ÿ£ŸÑŸàÿßŸÜ Ÿàÿ£ŸÇŸÖÿ¥ÿ© ÿßŸÑŸÖŸàÿ≥ŸÖ...",
            blog2_meta: "25 ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2025 ¬∑ ŸÜÿµÿßÿ¶ÿ≠",
            blog2_title: "ŸÉŸäŸÅŸäÿ© ÿ®ŸÜÿßÿ° ÿÆÿ≤ÿßŸÜÿ© ŸÖŸÑÿßÿ®ÿ≥ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©",
            blog2_excerpt: "ŸÜÿµÿßÿ¶ÿ≠ŸÜÿß ŸÑÿßÿÆÿ™Ÿäÿßÿ± ŸÇÿ∑ÿπ ŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖÿßÿ™ Ÿàÿπÿßÿ®ÿ±ÿ© ŸÑŸÑÿ≤ŸÖŸÜ...",
            blog3_meta: "18 ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2025 ¬∑ ÿ•ŸÑŸáÿßŸÖ",
            blog3_title: "ÿßŸÑŸÅÿ≥ÿ™ÿßŸÜ ÿßŸÑŸÖÿ´ÿßŸÑŸä ŸÑŸÉŸÑ ŸÖŸÜÿßÿ≥ÿ®ÿ©",
            blog3_excerpt: "ŸÖŸÜ ÿßŸÑŸÖŸÉÿ™ÿ® ÿ•ŸÑŸâ ÿßŸÑÿπÿ¥ÿßÿ°ÿå ÿßÿπÿ´ÿ±Ÿä ÿπŸÑŸâ ÿßŸÑŸÇÿµÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ®ÿ±ÿ≤ ÿ¨ŸÖÿßŸÑŸÉ...",
            read_more: "ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖÿ≤ŸäÿØ ‚Üê",
            lookbook_title: "ÿ£ÿ≠ÿØÿ´ ÿ•ÿ∑ŸÑÿßŸÑÿßÿ™ŸÜÿß",
            lookbook_subtitle: "ÿßÿ≥ÿ™ŸÑŸáŸÖŸä ŸÖŸÜ ÿ•ÿ∑ŸÑÿßŸÑÿßÿ™ŸÜÿß Ÿàÿßÿ®ÿ™ŸÉÿ±Ÿä ÿ£ÿ≥ŸÑŸàÿ®ŸÉ ÿßŸÑÿÆÿßÿµ.",
            recently_viewed_title: "ÿ¥ŸàŸáÿØÿ™ ŸÖÿ§ÿÆÿ±ÿß",
            testimonials_title: "ÿ≤ÿ®ÿßÿ¶ŸÜŸÜÿß Ÿäÿ≠ÿ®ŸàŸÜŸÜÿß",
            testimonials_subtitle: "ÿßŸÉÿ™ÿ¥ŸÅŸàÿß ÿ¥ŸáÿßÿØÿßÿ™ ŸÖÿ¨ÿ™ŸÖÿπŸÜÿß.",
            testimonial1_text: "\"ÿ£ÿÆŸäÿ±Ÿãÿß Ÿàÿ¨ÿØÿ™ ÿ®Ÿàÿ™ŸäŸÉŸãÿß ÿ®ŸÇÿ∑ÿπ ÿ£ÿµŸÑŸäÿ© Ÿàÿ∞ÿßÿ™ ÿ¨ŸàÿØÿ©. ŸÅÿ≥ÿ™ÿßŸÜŸä ÿßŸÑÿ¨ÿØŸäÿØ ÿ±ÿßÿ¶ÿπÿå ÿ£ÿ™ŸÑŸÇŸâ ÿßŸÑÿ•ÿ∑ÿ±ÿßÿ°ÿßÿ™ ŸÅŸÇÿ∑!\"",
            testimonial2_text: "\"ÿÆÿØŸÖÿ© ÿßŸÑÿπŸÖŸÑÿßÿ° ŸÑÿß ÿ™ÿµÿØŸÇ. ÿ™ŸÖ ŸÜÿµÿ≠Ÿä ÿπÿ®ÿ± ÿßŸÑŸáÿßÿ™ŸÅ ŸàŸÉÿßŸÜÿ™ ÿßŸÑÿ®ÿßÿ¶ÿπÿ© ÿ±ÿßÿ¶ÿπÿ© ŸàŸÇÿØŸÖÿ™ ŸÜÿµÿßÿ¶ÿ≠ ŸÖŸÖÿ™ÿßÿ≤ÿ©. ÿ™ŸàÿµŸäŸÑ ŸÅÿßÿ¶ŸÇ ÿßŸÑÿ≥ÿ±ÿπÿ©.\"",
            contact_title: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
            contact_subtitle: "ŸÑÿØŸäŸÉ ÿ≥ÿ§ÿßŸÑÿü ÿ£ÿ±ÿ≥ŸÑ ŸÑŸÜÿß ÿ±ÿ≥ÿßŸÑÿ© ÿ£Ÿà ŸÇŸÖ ÿ®ÿ≤Ÿäÿßÿ±ÿ™ŸÜÿß ŸÅŸä ÿßŸÑŸÖÿ™ÿ¨ÿ±!",
            form_name: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
            form_email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",
            form_message: "ÿ±ÿ≥ÿßŸÑÿ™ŸÉ",
            form_message_placeholder: "ÿ£ŸàÿØ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ≠ŸàŸÑ ÿßŸÑŸÅÿ≥ÿ™ÿßŸÜ ÿßŸÑÿ≤Ÿáÿ±Ÿä...",
            form_send: "ÿ•ÿ±ÿ≥ÿßŸÑ",
            contact_info_title: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ",
            address_label: "ÿßŸÑÿπŸÜŸàÿßŸÜ",
            phone_label: "ÿßŸÑŸáÿßÿ™ŸÅ",
            footer_rights: "¬© 2025 ÿ≥ÿ™ÿßŸäŸÑ ÿ£ŸÅŸÜŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.",
        }
      };

      const setLanguage = (lang) => {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.getAttribute('data-translate-key');
            if(translations[lang][key]) el.textContent = translations[lang][key];
        });

         document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
            const key = el.getAttribute('data-translate-placeholder');
             if(translations[lang][key]) el.placeholder = translations[lang][key];
        });

        document.getElementById('current-lang').textContent = lang.toUpperCase();
        document.getElementById('current-lang-mobile').textContent = lang.toUpperCase();
        localStorage.setItem('language', lang);
      };

      const langToggle = document.getElementById('lang-toggle');
      const langMenu = document.getElementById('lang-menu');
      langToggle.addEventListener('click', () => langMenu.classList.toggle('hidden'));
      
      const langToggleMobile = document.getElementById('lang-toggle-mobile');
      const langMenuMobile = document.getElementById('lang-menu-mobile');
      langToggleMobile.addEventListener('click', () => langMenuMobile.classList.toggle('hidden'));

      document.querySelectorAll('#lang-menu a, #lang-menu-mobile a').forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            const lang = e.target.getAttribute('data-lang');
            setLanguage(lang);
            langMenu.classList.add('hidden');
            langMenuMobile.classList.add('hidden');
        });
      });

      // Set initial language
      const savedLang = localStorage.getItem('language') || 'fr';
      setLanguage(savedLang);


      // --- Dark Mode Toggle ---
      const themeToggleBtns = document.querySelectorAll('#theme-toggle, #theme-toggle-mobile');
      const darkIcons = document.querySelectorAll('#theme-toggle-dark-icon, #theme-toggle-mobile .fa-moon');
      const lightIcons = document.querySelectorAll('#theme-toggle-light-icon, #theme-toggle-mobile .fa-sun');

      const setTheme = (theme) => {
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem('theme', theme);
          const isDark = theme === 'dark';
          darkIcons.forEach(i => i.classList.toggle('hidden', isDark));
          lightIcons.forEach(i => i.classList.toggle('hidden', !isDark));
          document.getElementById('testimonials').style.backgroundImage = `linear-gradient(rgba(${isDark ? '26, 32, 44, 0.92' : '255, 255, 255, 0.92'}), rgba(${isDark ? '26, 32, 44, 0.92' : '255, 255, 255, 0.92'})), url('https://images.unsplash.com/photo-1485230895905-ec40ba36b9bc?auto=format&fit=crop&q=80&w=2070')`;
      };
      const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setTheme(savedTheme);
      themeToggleBtns.forEach(btn => btn.addEventListener('click', () => setTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark')));

      // --- Header scroll & Back to Top Button ---
      window.addEventListener("scroll", () => {
        header.classList.toggle("scrolled", window.scrollY > 50);
        backToTopBtn.classList.toggle('hidden', window.scrollY <= 300);
      });
      backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

      // --- Mobile menu toggle ---
      mobileMenuBtn.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));

      // --- Smooth scroll & Active Nav Link on Scroll ---
      const sections = document.querySelectorAll('main section[id]');
      const navLinks = document.querySelectorAll('.nav-link');
      const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
              if (entry.isIntersecting) {
                  navLinks.forEach(link => {
                      link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                  });
              }
          });
      }, { rootMargin: '-50% 0px -50% 0px' });
      sections.forEach(section => observer.observe(section));
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const targetElement = document.querySelector(this.getAttribute('href'));
            if(targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
                if (!mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
            }
        });
      });
      
      // --- Scroll-triggered fade-in animation ---
      const animationObserver = new IntersectionObserver(entries => {
          entries.forEach(entry => {
              if (entry.isIntersecting) entry.target.classList.add('visible');
          });
      }, { threshold: 0.1 });
      document.querySelectorAll('.fade-in-up').forEach(el => animationObserver.observe(el));

        // --- Star Rating Generator ---
        const generateStars = (rating) => {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) stars += '<i class="fas fa-star"></i>';
                else if (i - 0.5 <= rating) stars += '<i class="fas fa-star-half-alt"></i>';
                else stars += '<i class="far fa-star"></i>';
            }
            return `<div class="star-rating">${stars}</div>`;
        };

        // --- Product Rendering, Filtering, Sorting, and AI Searching ---
        const productGrid = document.getElementById('product-grid');
        const filterBtns = document.querySelectorAll('.product-filter-btn');
        const searchBars = document.querySelectorAll('#search-bar, #search-bar-mobile');
        const sortSelect = document.getElementById('product-sort');
        const aiSearchFeedback = document.getElementById('ai-search-feedback');
        let currentFilters = {
            category: 'all',
            style: 'all',
            searchTerm: '',
            maxPrice: 20000,
            minPrice: 3000,
            sort: 'default',
            size: null,
            inStockOnly: false,
        };

        const renderProducts = (productsToRender) => {
            productGrid.innerHTML = '';
            if (productsToRender.length === 0) {
                productGrid.innerHTML = `<p class="col-span-full text-center text-secondary">Aucun produit ne correspond √† votre recherche.</p>`;
                return;
            }
            productsToRender.forEach(product => {
                const priceHTML = product.salePrice
                    ? `<span class="font-semibold text-lg" style="color:var(--accent-color)">${product.salePrice.toLocaleString('fr-FR')} DZD</span><span class="original-price text-sm">${product.price.toLocaleString('fr-FR')} DZD</span>`
                    : `<span class="font-semibold text-lg" style="color:var(--accent-color)">${product.price.toLocaleString('fr-FR')} DZD</span>`;
                
                const stockMessage = product.stock > 0 && product.stock < 10 ? `Plus que ${product.stock} en stock !` : '';
                const isOutOfStock = product.stock === 0;
                const buttonHTML = isOutOfStock 
                    ? `<button class="notify-me-btn text-white px-6 py-2 rounded-full font-semibold mt-2 w-full transition-transform transform hover:scale-105">Me notifier</button>`
                    : `<button class="add-to-cart-btn text-white px-6 py-2 rounded-full font-semibold mt-2 w-full transition-transform transform hover:scale-105" style="background-color: var(--accent-color);">Ajouter au Panier</button>`;

                const productCardHTML = `
                <div class="product-item bg-primary rounded-lg shadow-custom overflow-hidden flex flex-col" data-id="${product.id}">
                    <div class="relative overflow-hidden product-image-tilt">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-80 object-cover">
                        ${product.badge ? `<div class="product-badge ${product.badge.color}">${product.badge.text}</div>` : ''}
                        <button class="wishlist-btn" aria-label="Ajouter √† la wishlist"><i class="far fa-heart text-xl"></i></button>
                        <button class="quick-add-btn" aria-label="Ajout rapide"><i class="fas fa-plus"></i></button>
                        <div class="product-hover-overlay">
                            <button class="quick-view-btn w-full text-primary bg-white/90 py-2 rounded-md font-semibold">Aper√ßu rapide</button>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <p class="product-name font-bold text-lg text-primary">${product.name}</p>
                        <div class="flex items-center space-x-2 mt-1">
                            ${generateStars(product.rating)}
                            <span class="text-xs text-secondary">(${product.reviews.length} avis)</span>
                        </div>
                        <div class="product-price flex items-baseline mt-2">${priceHTML}</div>
                        <p class="stock-level text-sm text-red-500 font-semibold mt-2 h-5">${stockMessage}</p>
                        <div class="mt-auto pt-2">
                            ${buttonHTML}
                        </div>
                    </div>
                </div>`;
                productGrid.innerHTML += productCardHTML;
            });
            updateWishlistButtons();
        };

        const updateDisplayedProducts = () => {
            let processedProducts = [...allProducts];
            
            // Apply all filters
            if (currentFilters.category !== 'all') processedProducts = processedProducts.filter(p => p.category === currentFilters.category);
            if (currentFilters.style !== 'all') processedProducts = processedProducts.filter(p => p.style === currentFilters.style);
            if (currentFilters.searchTerm) processedProducts = processedProducts.filter(p => p.name.toLowerCase().includes(currentFilters.searchTerm.toLowerCase()));
            if (currentFilters.size) processedProducts = processedProducts.filter(p => p.sizes.includes(currentFilters.size));
            if (currentFilters.inStockOnly) processedProducts = processedProducts.filter(p => p.stock > 0);
            
            processedProducts = processedProducts.filter(p => {
                const price = p.salePrice || p.price;
                return price >= currentFilters.minPrice && price <= currentFilters.maxPrice;
            });

            // Sort
            const getPrice = p => p.salePrice || p.price;
            if (currentFilters.sort === 'price-asc') processedProducts.sort((a, b) => getPrice(a) - getPrice(b));
            else if (currentFilters.sort === 'price-desc') processedProducts.sort((a, b) => getPrice(b) - getPrice(a));
            else if (currentFilters.sort === 'name-asc') processedProducts.sort((a, b) => a.name.localeCompare(b.name));
            
            renderProducts(processedProducts);
        };
        
        // --- Event Listeners for Basic Filters ---
        filterBtns.forEach(btn => btn.addEventListener('click', () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilters.category = btn.dataset.filter;
            updateDisplayedProducts();
        }));

        sortSelect.addEventListener('change', e => {
            currentFilters.sort = e.target.value;
            updateDisplayedProducts();
        });

        // --- Event Listeners for Advanced Filters ---
        const priceRange = document.getElementById('price-range');
        const priceRangeValue = document.getElementById('price-range-value');
        priceRange.addEventListener('input', e => {
            currentFilters.maxPrice = parseInt(e.target.value);
            priceRangeValue.textContent = `${e.target.value} DZD`;
            updateDisplayedProducts();
        });

        const sizeFilterBtns = document.querySelectorAll('.size-filter-btn');
        sizeFilterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const size = btn.dataset.size;
                if (btn.classList.contains('active')) {
                    btn.classList.remove('active');
                    currentFilters.size = null;
                } else {
                    sizeFilterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilters.size = size;
                }
                updateDisplayedProducts();
            });
        });

        document.getElementById('in-stock-filter').addEventListener('change', e => {
            currentFilters.inStockOnly = e.target.checked;
            updateDisplayedProducts();
        });
        
        // --- Enhanced Search with Autocomplete ---
        const searchResultsDesktop = document.getElementById('search-results-desktop');
        const searchResultsMobile = document.getElementById('search-results-mobile');

        const handleSearchInput = (e, resultsContainer) => {
            const searchTerm = e.target.value.toLowerCase();
            
            // AI-based filtering from search query
            const aiFilters = parseSearchQuery(searchTerm);
            let combinedSearchTerm = searchTerm;
            
            // If AI filters are detected, clear the simple search term to avoid conflicts
            if (aiFilters.category !== 'all' || aiFilters.style !== 'all' || aiFilters.maxPrice !== Infinity || aiFilters.minPrice !== 0) {
                 aiSearchFeedback.textContent = `Filtres IA actifs`;
                 combinedSearchTerm = ''; // Clear text search if AI filters are active
            } else {
                 aiSearchFeedback.textContent = '';
            }
            
            // Update main product grid based on filters or search term
            currentFilters = { ...currentFilters, ...aiFilters, searchTerm: combinedSearchTerm };
            updateDisplayedProducts();

            // Handle autocomplete dropdown
            if (searchTerm.length < 2) {
                resultsContainer.innerHTML = '';
                resultsContainer.classList.add('hidden');
                return;
            }

            const matchedProducts = allProducts.filter(p => p.name.toLowerCase().includes(searchTerm)).slice(0, 5);
            
            if (matchedProducts.length > 0) {
                resultsContainer.innerHTML = matchedProducts.map(p => {
                    const price = p.salePrice || p.price;
                    return `
                        <div class="search-result-item" data-id="${p.id}">
                            <img src="${p.image}" alt="${p.name}" class="w-12 h-16 object-cover rounded-md mr-4">
                            <div class="flex-grow">
                                <p class="font-semibold text-sm text-primary">${p.name}</p>
                                <p class="text-xs" style="color:var(--accent-color)">${price.toLocaleString('fr-FR')} DZD</p>
                            </div>
                        </div>
                    `;
                }).join('');
                resultsContainer.classList.remove('hidden');
            } else {
                resultsContainer.innerHTML = '<p class="p-4 text-sm text-secondary">Aucun r√©sultat</p>';
                resultsContainer.classList.remove('hidden');
            }
        };

        searchBars.forEach(searchBar => {
            const resultsContainer = searchBar.id === 'search-bar' ? searchResultsDesktop : searchResultsMobile;
            searchBar.addEventListener('input', (e) => handleSearchInput(e, resultsContainer));
            searchBar.addEventListener('focus', (e) => handleSearchInput(e, resultsContainer));
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#search-bar') && !e.target.closest('#search-results-desktop')) {
                searchResultsDesktop.classList.add('hidden');
            }
            if (!e.target.closest('#search-bar-mobile') && !e.target.closest('#search-results-mobile')) {
                 searchResultsMobile.classList.add('hidden');
            }
             if (e.target.closest('.search-result-item')) {
                const productId = e.target.closest('.search-result-item').dataset.id;
                // Find product and trigger quick view
                const product = allProducts.find(p => p.id === productId);
                if(product) {
                    triggerQuickView(product);
                    searchResultsDesktop.classList.add('hidden');
                    searchResultsMobile.classList.add('hidden');
                }
            }
        });


        // --- Modals Initializer & HTML Injection ---
        const modalsContainer = document.getElementById('modals-container');
        modalsContainer.innerHTML = `
            <!-- Newsletter Modal -->
            <div id="newsletter-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]">
                <div id="newsletter-modal-box" class="bg-primary p-8 rounded-lg shadow-xl w-full max-w-md mx-4 transform scale-95 opacity-0">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold font-heading text-primary">Rejoignez notre Newsletter</h2><button id="newsletter-modal-close" class="text-2xl text-secondary">&times;</button></div>
                    <p class="text-secondary mb-6">Recevez nos nouveaut√©s et offres exclusives avant tout le monde !</p>
                    <form id="newsletter-form"><div class="mb-4"><label for="newsletter-name" class="block text-primary font-semibold mb-2">Pr√©nom</label><input type="text" id="newsletter-name" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><div class="mb-6"><label for="newsletter-email" class="block text-primary font-semibold mb-2">Email</label><input type="email" id="newsletter-email" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><button type="submit" class="w-full text-white p-3 rounded-full font-bold text-lg transition" style="background-color: var(--accent-color);">M'inscrire</button><p id="newsletter-form-status" class="text-center mt-4"></p></form>
                </div>
            </div>
            <!-- Checkout Modal -->
            <div id="checkout-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]">
                <div id="checkout-modal-box" class="bg-primary p-8 rounded-lg shadow-xl w-full max-w-md mx-4 transform scale-95 opacity-0">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold font-heading text-primary">Finaliser la Commande</h2><button id="checkout-modal-close" class="text-2xl text-secondary">&times;</button></div>
                    <p class="text-secondary mb-6">Veuillez entrer vos informations pour compl√©ter la commande.</p>
                    <form id="checkout-form"><div class="mb-4"><label for="checkout-name" class="block text-primary font-semibold mb-2">Nom Complet</label><input type="text" id="checkout-name" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><div class="mb-4"><label for="checkout-email" class="block text-primary font-semibold mb-2">Email</label><input type="email" id="checkout-email" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><div class="mb-6"><label for="checkout-phone" class="block text-primary font-semibold mb-2">T√©l√©phone</label><input type="tel" id="checkout-phone" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><button type="submit" class="w-full text-white p-3 rounded-full font-bold text-lg transition" style="background-color: var(--accent-color);">Confirmer la Commande</button><p id="checkout-form-status" class="text-center mt-4"></p></form>
                </div>
            </div>
            <!-- AI Stylist Modal -->
            <div id="ai-stylist-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="ai-stylist-modal-box" class="bg-primary p-0 rounded-lg shadow-xl w-full max-w-md mx-4 transform scale-95 opacity-0 flex flex-col h-[70vh]"><div class="flex justify-between items-center p-4 border-b border-color"><h2 class="text-xl font-bold font-heading text-primary flex items-center"><i class="fas fa-robot mr-2" style="color: var(--accent-color);"></i>Styliste Personnel</h2><button id="ai-stylist-modal-close" class="text-2xl text-secondary">&times;</button></div><div id="ai-chat-history" class="flex-grow p-4 overflow-y-auto space-y-4"></div><div id="ai-chat-options" class="p-4 border-t border-color"></div></div></div>
            <!-- Style Quiz Modal -->
            <div id="style-quiz-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="style-quiz-modal-box" class="bg-primary p-6 rounded-lg shadow-xl w-full max-w-2xl mx-4 transform scale-95 opacity-0 flex flex-col h-[80vh]"><div class="flex justify-between items-center pb-4 border-b border-color"><h2 class="text-2xl font-bold font-heading text-primary">D√©couvrez Votre Style</h2><button id="style-quiz-modal-close" class="text-2xl text-secondary">&times;</button></div><div id="style-quiz-content" class="flex-grow pt-4 overflow-y-auto"></div></div></div>
            <!-- Wishlist Modal -->
            <div id="wishlist-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="wishlist-modal-box" class="bg-primary p-0 rounded-lg shadow-xl w-full max-w-2xl mx-4 transform scale-95 opacity-0 flex flex-col h-[70vh]"><div class="flex justify-between items-center p-4 border-b border-color"><h2 class="text-2xl font-bold font-heading text-primary">Ma Wishlist</h2><button id="wishlist-modal-close" class="text-2xl text-secondary">&times;</button></div><div id="wishlist-content" class="flex-grow p-6 overflow-y-auto"><div id="empty-wishlist-message" class="text-center text-secondary py-12"><i class="fas fa-heart-crack text-5xl mb-4"></i><p>Votre wishlist est vide.</p></div></div></div></div>
            <!-- Quick View Modal -->
            <div id="quick-view-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="quick-view-modal-box" class="bg-primary rounded-lg shadow-xl w-11/12 max-w-lg md:max-w-4xl lg:max-w-6xl transform scale-95 opacity-0 max-h-[90vh] flex flex-col"><button id="quick-view-modal-close" class="absolute top-4 right-4 text-2xl text-secondary z-10">&times;</button><div id="quick-view-content" class="overflow-y-auto p-4 sm:p-8"></div></div></div>
            <!-- Live Chat Modal -->
            <div id="live-chat-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="live-chat-modal-box" class="bg-primary p-0 rounded-lg shadow-xl w-full max-w-md mx-4 transform scale-95 opacity-0 flex flex-col h-[70vh]"><div class="flex justify-between items-center p-4 border-b border-color"><h2 class="text-xl font-bold font-heading text-primary flex items-center"><i class="fas fa-headset mr-2" style="color: var(--accent-color);"></i>Live Support</h2><button id="live-chat-modal-close" class="text-2xl text-secondary">&times;</button></div><div id="live-chat-history" class="flex-grow p-4 overflow-y-auto space-y-4"></div><div id="live-chat-input" class="p-4 border-t border-color"><div id="live-chat-options" class="flex flex-wrap gap-2 justify-center"></div></div></div></div>
            <!-- Size Guide Modal -->
             <div id="size-guide-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="size-guide-modal-box" class="bg-primary p-8 rounded-lg shadow-xl w-full max-w-lg mx-4 transform scale-95 opacity-0"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold font-heading text-primary">Guide des Tailles</h2><button id="size-guide-modal-close" class="text-2xl text-secondary">&times;</button></div><table class="w-full text-left table-auto"><thead><tr><th class="p-2 border-b">Taille</th><th class="p-2 border-b">Poitrine (cm)</th><th class="p-2 border-b">Taille (cm)</th><th class="p-2 border-b">Hanches (cm)</th></tr></thead><tbody><tr><td class="p-2 border-b">S</td><td class="p-2 border-b">82-86</td><td class="p-2 border-b">62-66</td><td class="p-2 border-b">90-94</td></tr><tr><td class="p-2 border-b">M</td><td class="p-2 border-b">86-90</td><td class="p-2 border-b">66-70</td><td class="p-2 border-b">94-98</td></tr><tr><td class="p-2 border-b">L</td><td class="p-2 border-b">90-94</td><td class="p-2 border-b">70-74</td><td class="p-2 border-b">98-102</td></tr><tr><td class="p-2 border-b">XL</td><td class="p-2 border-b">94-98</td><td class="p-2 border-b">74-78</td><td class="p-2 border-b">102-106</td></tr></tbody></table></div></div>
            <!-- Notify Me Modal -->
            <div id="notify-me-modal-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center opacity-0 pointer-events-none z-[100]"><div id="notify-me-modal-box" class="bg-primary p-8 rounded-lg shadow-xl w-full max-w-md mx-4 transform scale-95 opacity-0"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold font-heading text-primary">Pr√©venez-moi !</h2><button id="notify-me-modal-close" class="text-2xl text-secondary">&times;</button></div><p class="text-secondary mb-6">Laissez votre email pour √™tre notifi√©(e) d√®s que ce produit est de retour en stock.</p><form id="notify-me-form"><input type="hidden" id="notify-product-id"><div class="mb-6"><label for="notify-email" class="block text-primary font-semibold mb-2">Email</label><input type="email" id="notify-email" class="form-input w-full p-3 border border-color rounded-lg focus:outline-none bg-secondary text-primary" required></div><button type="submit" class="w-full text-white p-3 rounded-full font-bold text-lg transition" style="background-color: var(--accent-color);">Envoyer</button><p id="notify-form-status" class="text-center mt-4"></p></form></div></div>
        `;
        
        const modals = {};
        const initModal = (modalId) => {
            const modalOverlay = document.getElementById(`${modalId}-overlay`);
            const modalBox = document.getElementById(`${modalId}-box`);
            const closeBtn = document.getElementById(`${modalId}-close`) || document.getElementById(`${modalId}-modal-close`);

            const open = () => { if(modalOverlay) { modalOverlay.classList.remove('opacity-0', 'pointer-events-none'); modalBox.classList.remove('scale-95', 'opacity-0'); }};
            const close = () => { 
                if(modalOverlay) { 
                    modalBox.classList.add('scale-95', 'opacity-0'); 
                    setTimeout(() => modalOverlay.classList.add('opacity-0', 'pointer-events-none'), 300); 
                }
                if (modalId === 'quick-view-modal' && current3DAnimationId) {
                    cancelAnimationFrame(current3DAnimationId);
                    current3DAnimationId = null;
                }
            };
            
            if (closeBtn) closeBtn.addEventListener('click', close);
            if (modalOverlay) modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) close(); });
            
            modals[modalId] = { open, close };
        };

        ['quick-view-modal', 'newsletter-modal', 'ai-stylist-modal', 'style-quiz-modal', 
         'wishlist-modal', 'checkout-modal', 'live-chat-modal', 'size-guide-modal', 'notify-me-modal'].forEach(id => initModal(id));
        
        document.querySelectorAll('[id^=newsletter-cta]').forEach(btn => btn.addEventListener('click', (e) => { e.preventDefault(); modals['newsletter-modal'].open(); if (!mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden'); }));
        document.getElementById('ai-stylist-cta').addEventListener('click', () => { modals['ai-stylist-modal'].open(); window.ai_stylist_modal_on_open(); });
        document.getElementById('style-quiz-cta').addEventListener('click', () => { modals['style-quiz-modal'].open(); window.style_quiz_modal_on_open(); });
        document.querySelectorAll('#wishlist-toggle, #wishlist-toggle-mobile').forEach(btn => btn.addEventListener('click', () => { modals['wishlist-modal'].open(); window.wishlist_modal_on_open(); }));
        
        // --- Shopping Cart ---
        let cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];
        let discount = null;
        const VALID_DISCOUNTS = { "BIENVENUE10": { type: "percentage", value: 10 }, "SOLDE2000": { type: "fixed", value: 2000 } };
        const cartSidebarEl = document.getElementById('shopping-cart-sidebar');
        cartSidebarEl.innerHTML = `
          <div id="cart-sidebar-overlay" class="fixed inset-0 bg-black/60 opacity-0 pointer-events-none z-[90] transition-opacity duration-300"></div>
          <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-primary transform translate-x-full shadow-xl z-[100] transition-transform duration-300 flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-color"><h2 class="text-2xl font-bold font-heading text-primary">Votre Panier</h2><button id="cart-close-btn" class="text-2xl text-secondary">&times;</button></div>
            <div id="cart-items" class="flex-grow p-6 overflow-y-auto"><div id="empty-cart-message" class="text-center text-secondary py-12"><i class="fas fa-shopping-cart text-5xl mb-4"></i><p>Votre panier est vide.</p></div></div>
            <div id="cart-footer" class="p-6 border-t border-color">
                <div class="mb-4"><div class="flex items-center space-x-2"><input type="text" id="discount-code" placeholder="Code promo" class="form-input w-full p-2 border rounded-md bg-secondary text-primary"><button id="apply-discount-btn" class="text-white px-4 py-2 rounded-md font-semibold" style="background-color: var(--accent-color);">Appliquer</button></div><p id="discount-status" class="text-sm mt-2 h-4"></p></div>
                <div class="space-y-2 font-semibold text-lg"><div class="flex justify-between"><span>Sous-total</span><span id="cart-subtotal">0 DZD</span></div><div id="discount-display" class="hidden flex justify-between text-green-600"><span>R√©duction</span><span id="cart-discount">-0 DZD</span></div><div class="flex justify-between text-primary font-bold text-xl pt-2 border-t mt-2"><span>Total</span><span id="cart-total">0 DZD</span></div></div>
                <button id="checkout-btn" class="w-full mt-4 text-white p-3 rounded-full font-bold text-lg" style="background-color: var(--accent-color);">Passer √† la caisse</button>
            </div>
          </div>`;

        const cartSidebar = document.getElementById('cart-sidebar');
        const cartOverlay = document.getElementById('cart-sidebar-overlay');
        const openCart = () => { cartSidebar.classList.remove('translate-x-full'); cartOverlay.classList.remove('opacity-0', 'pointer-events-none'); };
        const closeCart = () => { cartSidebar.classList.add('translate-x-full'); cartOverlay.classList.add('opacity-0', 'pointer-events-none'); };
        
        const updateCart = () => {
            const cartItemsContainer = document.getElementById('cart-items');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            cartItemsContainer.innerHTML = '';
            cartItemsContainer.appendChild(emptyCartMessage);
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                document.getElementById('cart-footer').style.display = 'none';
            } else {
                emptyCartMessage.style.display = 'none';
                document.getElementById('cart-footer').style.display = 'block';
                cart.forEach(item => {
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'flex items-start space-x-4 mb-6';
                    const finalPrice = item.salePrice || item.price;
                    cartItemEl.innerHTML = `<img src="${item.image}" alt="${item.name}" class="w-20 h-24 object-cover rounded-md"><div class="flex-grow"><p class="font-bold text-primary">${item.name}</p><p class="text-secondary text-sm">Taille: ${item.size}</p><p class="font-semibold text-sm" style="color: var(--accent-color);">${finalPrice.toLocaleString('fr-FR')} DZD</p><input type="number" min="1" value="${item.quantity}" data-id="${item.id}" data-size="${item.size}" class="cart-item-quantity w-16 p-1 border rounded-md bg-primary text-primary mt-2"></div><button data-id="${item.id}" data-size="${item.size}" class="remove-from-cart-btn text-red-500 text-lg"><i class="fas fa-trash-alt"></i></button>`;
                    cartItemsContainer.appendChild(cartItemEl);
                });
            }
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.querySelectorAll('#cart-item-count, #cart-item-count-mobile').forEach(span => span.textContent = totalItems);
            const subtotal = cart.reduce((sum, item) => sum + ((item.salePrice || item.price) * item.quantity), 0);
            let discountAmount = 0;
            if (discount) {
                discountAmount = discount.type === "percentage" ? subtotal * (discount.value / 100) : discount.value;
                document.getElementById('discount-display').classList.remove('hidden');
                document.getElementById('cart-discount').textContent = `-${discountAmount.toLocaleString('fr-FR')} DZD`;
            } else {
                document.getElementById('discount-display').classList.add('hidden');
            }
            const total = Math.max(0, subtotal - discountAmount);
            document.getElementById('cart-subtotal').textContent = `${subtotal.toLocaleString('fr-FR')} DZD`;
            document.getElementById('cart-total').textContent = `${total.toLocaleString('fr-FR')} DZD`;
            localStorage.setItem('shoppingCart', JSON.stringify(cart));
        };

        const addProductToCart = (productData, size) => {
            const existingItem = cart.find(item => item.id === productData.id && item.size === size);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...productData, quantity: 1, size: size });
            }
            updateCart();
            openCart();
        };

        const triggerQuickView = (product) => {
            if(!product) return;
            const isModalAlreadyOpen = !document.getElementById('quick-view-modal-overlay').classList.contains('opacity-0');
            addToRecentlyViewed(product.id);
            const content = document.getElementById('quick-view-content');
            
            const priceHTML = product.salePrice
                ? `<span class="text-2xl font-semibold my-2" style="color:var(--accent-color)">${product.salePrice.toLocaleString('fr-FR')} DZD</span> <span class="original-price text-lg">${product.price.toLocaleString('fr-FR')} DZD</span>`
                : `<span class="text-2xl font-semibold my-2" style="color:var(--accent-color)">${product.price.toLocaleString('fr-FR')} DZD</span>`;
            
            const reviewsHTML = product.reviews.length > 0
                ? product.reviews.map(r => `<div class="border-t border-color py-4"><div class="flex items-center mb-1">${generateStars(r.rating)}<p class="font-bold text-primary ml-3">${r.author}</p></div><p class="text-secondary italic">"${r.text}"</p></div>`).join('')
                : '<p class="text-secondary py-4">Aucun avis pour ce produit.</p>';
            
            const recommendations = allProducts.filter(p => p.category === product.category && p.id !== product.id).slice(0, 3);
            const recommendationsHTML = recommendations.map(p => `
                <div class="product-item bg-secondary rounded-lg shadow-custom overflow-hidden" data-id="${p.id}">
                     <div class="relative overflow-hidden">
                        <img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover">
                         <div class="product-hover-overlay !opacity-100 !transform-none !bg-transparent p-2 flex justify-end">
                            <button class="quick-view-btn w-auto bg-white/80 text-primary px-3 py-1 rounded-full text-xs font-semibold">Voir</button>
                        </div>
                    </div>
                    <div class="p-3">
                        <p class="font-bold text-sm text-primary truncate">${p.name}</p>
                        <div class="text-xs mt-1">${generateStars(p.rating)}</div>
                    </div>
                </div>`).join('');
            
            content.innerHTML = `
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                       <div id="d-viewer-container" class="bg-secondary rounded-lg mb-4"></div>
                       <p class="text-secondary text-sm text-center">Faites glisser pour faire pivoter le produit.</p>
                    </div>
                    <div data-id="${product.id}" class="flex flex-col">
                        <h2 class="product-name text-3xl font-bold font-heading text-primary">${product.name}</h2>
                        <div class="flex items-center space-x-2 my-2">
                            ${generateStars(product.rating)}
                            <span class="text-sm text-secondary">(${product.reviews.length} avis)</span>
                        </div>
                        <div class="product-price flex items-baseline">${priceHTML}</div>
                        <div class="mt-6">
                            <div class="flex justify-between items-center">
                                <label class="font-semibold text-primary">Taille:</label>
                                <a href="#" id="size-guide-link" class="text-sm underline" style="color:var(--accent-color)">Guide des tailles</a>
                            </div>
                            <select class="product-size form-input w-full p-2 mt-2 border rounded-md bg-secondary">${product.sizes.map(s => `<option>${s}</option>`).join('')}</select>
                        </div>
                        <button class="add-to-cart-btn w-full mt-4 text-white p-3 rounded-full font-bold text-lg" style="background-color: var(--accent-color);">Ajouter au Panier</button>
                    </div>
                </div>
                <div class="mt-10">
                    <h3 class="text-2xl font-bold font-heading text-primary border-b border-color pb-2 mb-4">Avis des Clients</h3>
                    <div class="max-h-60 overflow-y-auto pr-4">${reviewsHTML}</div>
                </div>
                 <div class="mt-10">
                    <h3 class="text-2xl font-bold font-heading text-primary border-b border-color pb-2 mb-4">Vous pourriez aussi aimer</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">${recommendationsHTML}</div>
                </div>
            `;
            const viewerContainer = document.getElementById('d-viewer-container');
            init3DViewer(viewerContainer, product);

            document.getElementById('size-guide-link').addEventListener('click', (e) => {
                e.preventDefault();
                modals['size-guide-modal'].open();
            });
            
            if (!isModalAlreadyOpen) {
                modals['quick-view-modal'].open();
            } else {
                content.scrollTop = 0; // Reset scroll for new content
            }
        };

        document.body.addEventListener('click', e => {
            const productEl = e.target.closest('[data-id]');
            const productId = productEl ? productEl.dataset.id : null;
            
            // Add to cart
            if (e.target.closest('.add-to-cart-btn')) {
                const productData = allProducts.find(p => p.id === productId);
                const size = productEl.querySelector('.product-size') ? productEl.querySelector('.product-size').value : 'Unique';
                addProductToCart(productData, size);
            }
            // Quick Add
            if (e.target.closest('.quick-add-btn')) {
                const product = allProducts.find(p => p.id === productId);
                if (product) {
                    if (product.sizes.length > 1) {
                        triggerQuickView(product); // Has sizes, so open quick view to select one
                    } else {
                        addProductToCart(product, 'Unique'); // No sizes needed, add directly
                    }
                }
            }
            // Notify Me
            if (e.target.closest('.notify-me-btn')) {
                document.getElementById('notify-product-id').value = productId;
                modals['notify-me-modal'].open();
            }

            if (e.target.closest('#checkout-btn')) { closeCart(); modals['checkout-modal'].open(); }
            if (e.target.closest('#cart-close-btn') || e.target.id === 'cart-sidebar-overlay') closeCart();
            if (e.target.closest('#apply-discount-btn')) {
                const code = document.getElementById('discount-code').value.toUpperCase();
                const discountStatus = document.getElementById('discount-status');
                if (VALID_DISCOUNTS[code]) { discount = VALID_DISCOUNTS[code]; discountStatus.textContent = "Code promo appliqu√© !"; discountStatus.style.color = 'green'; } else { discount = null; discountStatus.textContent = "Code promo invalide."; discountStatus.style.color = 'red'; }
                updateCart();
            }
            if (e.target.closest('.remove-from-cart-btn')) {
                const { id, size } = e.target.closest('.remove-from-cart-btn').dataset;
                cart = cart.filter(item => !(item.id === id && item.size === size));
                updateCart();
            }
            if(e.target.closest('.quick-view-btn')) {
                const product = allProducts.find(p => p.id === productId);
                triggerQuickView(product);
            }
        });

        // Notify Me form submission
        document.getElementById('notify-me-form').addEventListener('submit', e => {
            e.preventDefault();
            const status = document.getElementById('notify-form-status');
            status.textContent = "Merci ! Nous vous pr√©viendrons.";
            status.style.color = 'green';
            setTimeout(() => {
                modals['notify-me-modal'].close();
                status.textContent = "";
            }, 2000);
        });

        document.body.addEventListener('change', e => { if (e.target.classList.contains('cart-item-quantity')) { const { id, size } = e.target.dataset; const newQuantity = parseInt(e.target.value); const itemInCart = cart.find(item => item.id === id && item.size === size); if (itemInCart && newQuantity > 0) { itemInCart.quantity = newQuantity; updateCart(); } } });
        document.querySelectorAll('#cart-toggle, #cart-toggle-mobile').forEach(btn => btn.addEventListener('click', openCart));
      
      // --- Wishlist ---
      let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
      const updateWishlistButtons = () => { document.querySelectorAll('.wishlist-btn').forEach(btn => { const productId = btn.closest('.product-item').dataset.id; const isWished = wishlist.includes(productId); btn.classList.toggle('active', isWished); btn.querySelector('i').classList.toggle('far', !isWished); btn.querySelector('i').classList.toggle('fas', isWished); }); };
      window.wishlist_modal_on_open = () => { const wishlistContent = document.getElementById('wishlist-content'); const emptyMsg = document.getElementById('empty-wishlist-message'); wishlistContent.innerHTML = ''; wishlistContent.appendChild(emptyMsg); emptyMsg.style.display = wishlist.length === 0 ? 'block' : 'none'; wishlist.forEach(productId => { const product = allProducts.find(p => p.id === productId); if (product) { const itemEl = document.createElement('div'); itemEl.className = 'wishlist-item flex items-center space-x-4 mb-6 border-b pb-4'; itemEl.dataset.id = productId; const finalPrice = product.salePrice || product.price; itemEl.innerHTML = `<img src="${product.image}" class="w-20 h-24 object-cover rounded-md"><div class="flex-grow"><p class="product-name font-bold">${product.name}</p><p class="product-price text-sm">${finalPrice.toLocaleString('fr-FR')} DZD</p><button class="add-to-cart-btn text-white text-xs px-3 py-1 rounded-full font-semibold mt-2" style="background-color: var(--accent-color);">Ajouter</button></div><button class="remove-from-wishlist-btn text-red-500 text-lg"><i class="fas fa-trash-alt"></i></button>`; wishlistContent.appendChild(itemEl); } }); };
      document.body.addEventListener('click', e => {
          if (e.target.closest('.wishlist-btn')) { const productId = e.target.closest('.product-item').dataset.id; if (wishlist.includes(productId)) wishlist = wishlist.filter(id => id !== productId); else wishlist.push(productId); localStorage.setItem('wishlist', JSON.stringify(wishlist)); updateWishlistButtons(); }
          if (e.target.closest('.remove-from-wishlist-btn')) { const productId = e.target.closest('.wishlist-item').dataset.id; wishlist = wishlist.filter(id => id !== productId); localStorage.setItem('wishlist', JSON.stringify(wishlist)); updateWishlistButtons(); window.wishlist_modal_on_open(); }
      });

      // --- 3D Product Viewer Logic ---
      const init3DViewer = (container, product) => {
            if (!container) return;
            // Scene
            const scene = new THREE.Scene();
            // Camera
            const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 3;
            // Renderer
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.innerHTML = '';
            container.appendChild(renderer.domElement);
            // Light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(0, 1, 1);
            scene.add(directionalLight);
            // Object (Box with product texture)
            const textureLoader = new THREE.TextureLoader();
            const texture = textureLoader.load(product.image, () => {}, undefined, () => {}); // Added empty error handler
            texture.colorSpace = THREE.SRGBColorSpace;
            const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
            const material = new THREE.MeshStandardMaterial({ map: texture });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);
            
            // Mouse Controls
            let isMouseDown = false, prevMouseX = null, prevMouseY = null;
            container.addEventListener('mousedown', e => { isMouseDown = true; });
            container.addEventListener('mouseup', e => { isMouseDown = false; });
            container.addEventListener('mouseleave', e => { isMouseDown = false; });
            container.addEventListener('mousemove', e => {
                if (isMouseDown) {
                    const deltaX = e.clientX - prevMouseX;
                    cube.rotation.y += deltaX * 0.01;
                }
                prevMouseX = e.clientX;
            });
            
            // Animation loop
            const animate = () => {
                current3DAnimationId = requestAnimationFrame(animate);
                if (!isMouseDown) {
                    cube.rotation.y += 0.005; // Auto-rotate
                }
                renderer.render(scene, camera);
            };
            animate();
      };


      // --- AI Stylist Image Analysis Logic ---
      const aiStylistImageUpload = document.getElementById('ai-stylist-image-upload');
      aiStylistImageUpload.addEventListener('change', e => {
          if (e.target.files && e.target.files[0]) {
              const reader = new FileReader();
              reader.onload = e => {
                  addAgentMessage(aiChatHistory, 'Merci ! J\'analyse l\'image pour trouver des articles correspondants...');
                  setTimeout(() => {
                       addAgentMessage(aiChatHistory, 'D\'apr√®s l\'image, voici ce qui pourrait vous plaire :');
                       const recommendedProducts = allProducts.filter(p => p.style === 'elegant').slice(0, 2);
                       recommendedProducts.forEach(p => addAgentMessage(aiChatHistory, createProductHtml(p), true));
                       setTimeout(() => {
                            addAgentMessage(aiChatHistory, "Puis-je vous aider avec autre chose ?");
                            showOptions(aiChatOptions, [{ text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }]);
                       }, 1000);
                  }, 2500);
              }
              reader.readAsDataURL(e.target.files[0]);
          }
      });

        // --- AI Stylist Logic ---
        const aiChatHistory = document.getElementById('ai-chat-history');
        const aiChatOptions = document.getElementById('ai-chat-options');
        let userChoices = {};

        const addAgentMessage = (container, content, isHtml = false) => {
            if (!container) return;
            const messageEl = document.createElement('div');
            messageEl.className = 'flex flex-col items-start';
            messageEl.innerHTML = `<div class="agent-bubble">${isHtml ? content : content}</div>`;
            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;
        };
        const addUserMessage = (container, content) => {
            if (!container) return;
            const messageEl = document.createElement('div');
            messageEl.className = 'flex flex-col items-end';
            messageEl.innerHTML = `<div class="user-bubble">${content}</div>`;
            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;
        };

        const showOptions = (container, options) => {
            if (!container) return;
            container.innerHTML = '';
            const optionsWrapper = document.createElement('div');
            optionsWrapper.className = 'flex flex-wrap gap-2 justify-center';
            options.forEach(opt => {
                const button = document.createElement('button');
                button.textContent = opt.text;
                button.className = 'border border-color text-primary px-4 py-2 rounded-full hover:bg-secondary transition text-sm';
                button.onclick = () => opt.handler(opt.value);
                optionsWrapper.appendChild(button);
            });
            container.appendChild(optionsWrapper);
        };

        const handleOccasionChoice = (occasion) => {
            addUserMessage(aiChatHistory, occasion);
            userChoices.occasion = occasion;
            aiChatOptions.innerHTML = '';
            setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Excellent choix ! Et quel est votre style pr√©f√©r√© ?');
                showOptions(aiChatOptions, [
                    { text: 'D√©contract√©', value: 'casual', handler: handleStyleChoice },
                    { text: '√âl√©gant', value: 'elegant', handler: handleStyleChoice },
                ]);
            }, 500);
        };
        
        const handleStyleChoice = (style) => {
            addUserMessage(aiChatHistory, style);
            userChoices.style = style;
            localStorage.setItem('preferredStyle', style); // Save style preference
            aiChatOptions.innerHTML = '';
            setTimeout(() => {
                addAgentMessage(aiChatHistory, 'J\'ai quelques id√©es ! Avez-vous un budget en t√™te ?');
                showOptions(aiChatOptions, [
                    { text: 'Moins de 8000 DZD', value: {min: 0, max: 7999}, handler: (range) => handleBudgetChoice('Moins de 8000 DZD', range) },
                    { text: '8000 - 15000 DZD', value: {min: 8000, max: 15000}, handler: (range) => handleBudgetChoice('8000 - 15000 DZD', range) },
                    { text: 'Tout budget', value: {min: 0, max: Infinity}, handler: (range) => handleBudgetChoice('Tout budget', range) },
                ]);
            }, 500);
        };

        const handleBudgetChoice = (choiceText, range) => {
            addUserMessage(aiChatHistory, choiceText);
            userChoices.minPrice = range.min;
            userChoices.maxPrice = range.max;
            userChoices.shownProducts = []; // Reset for new search
            setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Parfait. Je cherche les articles qui vous correspondent...');
                showRecommendations();
            }, 500);
        };
        
        const showRecommendations = () => {
            aiChatOptions.innerHTML = '<p class="text-center text-secondary">Analyse en cours...</p>';

            setTimeout(() => {
                const getPrice = p => p.salePrice || p.price;
                const recommendations = allProducts.filter(p =>
                    p.style === userChoices.style &&
                    p.category !== 'accessories' &&
                    getPrice(p) >= userChoices.minPrice &&
                    getPrice(p) <= userChoices.maxPrice &&
                    !userChoices.shownProducts.includes(p.id) // Exclude already shown products
                );

                let recommendedProduct = recommendations[0] || null;

                if (recommendedProduct) {
                     if(userChoices.shownProducts.length === 0) {
                         addAgentMessage(aiChatHistory, 'Voici ma s√©lection personnalis√©e pour vous :');
                     } else {
                         addAgentMessage(aiChatHistory, 'Voici une autre suggestion :');
                     }

                    userChoices.shownProducts.push(recommendedProduct.id); // Add to shown list

                     const finalPrice = recommendedProduct.salePrice || recommendedProduct.price;
                     const recommendationHtml = `
                        <div class="bg-secondary rounded-lg p-3 flex items-center gap-4" data-id="${recommendedProduct.id}">
                            <img src="${recommendedProduct.image}" class="w-16 h-20 object-cover rounded-md"/>
                            <div class="flex-grow">
                                <p class="product-name font-bold text-sm text-primary">${recommendedProduct.name}</p>
                                <p class="product-price font-semibold text-xs" style="color:var(--accent-color)">${finalPrice.toLocaleString('fr-FR')} DZD</p>
                            </div>
                            <button class="add-to-cart-btn text-white text-2xl rounded-full w-10 h-10 flex-shrink-0" style="background-color: var(--accent-color);">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    `;
                    addAgentMessage(aiChatHistory, recommendationHtml, true);
                    
                    setTimeout(() => {
                        addAgentMessage(aiChatHistory, "Qu'en pensez-vous ?");
                        
                        const nextOptions = [
                            { text: 'Accessoire assorti', value: 'accessory', handler: () => handleFindAccessory(recommendedProduct.style) },
                            { text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }
                        ];

                        if (recommendations.length > 1) {
                            nextOptions.splice(1, 0, { text: 'Articles similaires', value: 'similar', handler: () => {
                                addUserMessage(aiChatHistory, "Montrez-moi des articles similaires.");
                                showRecommendations();
                            }});
                        }

                        showOptions(aiChatOptions, nextOptions);

                    }, 1000);

                } else {
                     if(userChoices.shownProducts.length === 0) {
                        addAgentMessage(aiChatHistory, "Oups, je n'ai rien trouv√© correspondant √† vos crit√®res. Essayons une autre option ?");
                     } else {
                        addAgentMessage(aiChatHistory, "Je n'ai pas d'autres articles similaires √† vous proposer dans cette s√©lection.");
                     }
                     setTimeout(() => {
                        showOptions(aiChatOptions, [{ text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }]);
                     }, 1000);
                }
            }, 1500);
        };
        
        const handleOutfitBuilder = () => {
            addUserMessage(aiChatHistory, 'Cr√©er une tenue compl√®te.');
            userChoices = { outfitBuilder: true, completeOutfit: {} };
            aiChatOptions.innerHTML = '';
            setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Excellente id√©e ! Commen√ßons par la pi√®ce principale. Que pr√©f√©rez-vous ?');
                showOptions(aiChatOptions, [
                    { text: 'Un Haut', value: 'tops', handler: handleOutfitPrimaryChoice },
                    { text: 'Une Robe', value: 'dresses', handler: handleOutfitPrimaryChoice },
                ]);
            }, 500);
        };
        
        const handleOutfitPrimaryChoice = (category) => {
            addUserMessage(aiChatHistory, category === 'tops' ? 'Un Haut' : 'Une Robe');
            userChoices.primaryCategory = category;
            const primaryItem = allProducts.find(p => p.category === category);
            userChoices.completeOutfit.primary = primaryItem;
            userChoices.style = primaryItem.style; // Set style for the rest of the outfit

            aiChatOptions.innerHTML = '<p class="text-center text-secondary">Je s√©lectionne une pi√®ce...</p>';
            setTimeout(() => {
                addAgentMessage(aiChatHistory, `Voici un excellent choix pour commencer :`);
                addAgentMessage(aiChatHistory, createProductHtml(primaryItem), true);
                 setTimeout(() => {
                    if (category === 'tops') {
                        addAgentMessage(aiChatHistory, 'Maintenant, trouvons un bas pour aller avec.');
                        handleOutfitBottomChoice();
                    } else {
                        addAgentMessage(aiChatHistory, 'Trouvons maintenant un accessoire pour compl√©ter cette robe.');
                        handleOutfitAccessoryChoice();
                    }
                }, 1000);
            }, 1500);
        };

        const handleOutfitBottomChoice = () => {
             const bottomItem = allProducts.find(p => p.category === 'pants' && p.style === userChoices.style);
             userChoices.completeOutfit.bottom = bottomItem;
              setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Que pensez-vous de cet ensemble ?');
                addAgentMessage(aiChatHistory, createProductHtml(bottomItem), true);
                setTimeout(() => {
                    addAgentMessage(aiChatHistory, 'Il ne manque plus qu\'un accessoire !');
                    handleOutfitAccessoryChoice();
                }, 1000);
             }, 1500);
        };

        const handleOutfitAccessoryChoice = () => {
            const accessoryItem = allProducts.find(p => p.category === 'accessories' && p.style === userChoices.style);
            userChoices.completeOutfit.accessory = accessoryItem;
             setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Et pour la touche finale :');
                addAgentMessage(aiChatHistory, createProductHtml(accessoryItem), true);
                 setTimeout(() => {
                    addAgentMessage(aiChatHistory, 'Et voil√† ! Une tenue compl√®te. J\'esp√®re que cela vous pla√Æt.');
                     showOptions(aiChatOptions, [{ text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }]);
                }, 1000);
            }, 1500);
        };
        
        const createProductHtml = (product) => {
             const finalPrice = product.salePrice || product.price;
             return `<div class="bg-secondary rounded-lg p-3 flex items-center gap-4" data-id="${product.id}">
                        <img src="${product.image}" class="w-16 h-20 object-cover rounded-md"/>
                        <div class="flex-grow">
                            <p class="product-name font-bold text-sm text-primary">${product.name}</p>
                            <p class="product-price font-semibold text-xs" style="color:var(--accent-color)">${finalPrice.toLocaleString('fr-FR')} DZD</p>
                        </div>
                        <button class="add-to-cart-btn text-white text-2xl rounded-full w-10 h-10 flex-shrink-0" style="background-color: var(--accent-color);"><i class="fas fa-plus"></i></button>
                    </div>`;
        };


        const handleFindAccessory = (style) => {
            addUserMessage(aiChatHistory, "Oui, avec plaisir !");
            aiChatOptions.innerHTML = '<p class="text-center text-secondary">Je cherche l\'accessoire parfait...</p>';
            setTimeout(() => {
                const matchingAccessory = allProducts.find(p => p.category === 'accessories' && p.style === style);
                if (matchingAccessory) {
                    addAgentMessage(aiChatHistory, `Excellent ! Je pense que ceci irait parfaitement avec :`);
                    addAgentMessage(aiChatHistory, createProductHtml(matchingAccessory), true);
                } else {
                    addAgentMessage(aiChatHistory, "Je n'ai pas trouv√© d'accessoire parfaitement assorti pour le moment, d√©sol√© !");
                }
                 setTimeout(() => {
                    addAgentMessage(aiChatHistory, "Puis-je vous aider avec autre chose ?");
                    showOptions(aiChatOptions, [{ text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }]);
                }, 1000);
            }, 1500);
        };

        const handleTrendingChoice = () => {
            addUserMessage(aiChatHistory, "Qu'est-ce qui est tendance ?");
            aiChatOptions.innerHTML = '';
            setTimeout(() => {
                addAgentMessage(aiChatHistory, 'Bonne question ! Voici les articles qui sont tr√®s populaires en ce moment :');
                const trendingProducts = allProducts.filter(p => p.badge && p.badge.text === 'Top Vente').slice(0, 2);
                 if (trendingProducts.length > 0) {
                    trendingProducts.forEach(p => addAgentMessage(aiChatHistory, createProductHtml(p), true) );
                }
                setTimeout(() => {
                    addAgentMessage(aiChatHistory, "Est-ce que l'un de ces articles vous pla√Æt, ou souhaitez-vous explorer autre chose ?");
                    showOptions(aiChatOptions, [{ text: 'Recommencer', value: 'restart', handler: () => startStylist(false) }]);
                }, 1000);
            }, 1000);
        };

        const handleSurpriseChoice = () => {
            addUserMessage(aiChatHistory, "Surprenez-moi !");
            aiChatOptions.innerHTML = '<p class="text-center text-secondary">Je cherche la perle rare...</p>';
            setTimeout(() => {
                const randomProduct = allProducts[Math.floor(Math.random() * allProducts.length)];
                addAgentMessage(aiChatHistory, "Que pensez-vous de ceci ?");
                addAgentMessage(aiChatHistory, createProductHtml(randomProduct), true);
                 setTimeout(() => {
                    addAgentMessage(aiChatHistory, "Alors, coup de coeur ?");
                    showOptions(aiChatOptions, [{ text: 'Autre chose !', value: 'restart', handler: () => startStylist(false) }]);
                }, 1000);
            }, 1500);
        };
        
        const handleImageAnalysis = () => {
            addUserMessage(aiChatHistory, "Analyser une image.");
            aiStylistImageUpload.click();
            aiChatOptions.innerHTML = '<p class="text-center text-secondary">Veuillez s√©lectionner une image √† analyser...</p>';
        };

        const startStylist = (isFirstTime = true) => {
            userChoices = {};
            if(isFirstTime) aiChatHistory.innerHTML = '';
            setTimeout(() => {
                const preferredStyle = localStorage.getItem('preferredStyle');
                if(isFirstTime && preferredStyle) {
                     addAgentMessage(aiChatHistory, `Bonjour ! Pr√™t(e) √† d√©couvrir d'autres articles au style <span class="font-semibold">${preferredStyle}</span> ? Ou souhaitez-vous explorer autre chose ?`);
                } else if (isFirstTime) {
                    addAgentMessage(aiChatHistory, 'Bonjour ! Je suis votre styliste personnel. Comment puis-je vous inspirer aujourd\'hui ?');
                }
                
                showOptions(aiChatOptions, [
                    { text: 'Trouver une tenue', value: 'occasion', handler: () => {
                        addUserMessage(aiChatHistory, "Je cherche une tenue.");
                        setTimeout(() => {
                             addAgentMessage(aiChatHistory, 'Avec plaisir ! Pour quelle occasion ?');
                             showOptions(aiChatOptions, [
                                { text: 'Quotidien', value: 'Quotidien', handler: handleOccasionChoice },
                                { text: 'Soir√©e', value: 'Soir√©e', handler: handleOccasionChoice },
                                { text: 'Travail', value: 'Travail', handler: handleOccasionChoice },
                            ]);
                        }, 500);
                    }},
                    { text: 'Cr√©er une tenue compl√®te', value: 'outfit_builder', handler: handleOutfitBuilder },
                    { text: 'Qu\'est-ce qui est tendance ?', value: 'trending', handler: handleTrendingChoice },
                    { text: 'Analyser une image', value: 'image_analysis', handler: handleImageAnalysis },
                ]);
            }, isFirstTime ? 500 : 100);
        };
        window.ai_stylist_modal_on_open = startStylist;

      // --- Live Chat Logic ---
        const liveChatHistory = document.getElementById('live-chat-history');
        const liveChatInput = document.getElementById('live-chat-input');
        const liveChatOptions = document.getElementById('live-chat-options');

        const showLiveChatOptions = (options) => {
            liveChatInput.innerHTML = `<div id="live-chat-options" class="flex flex-wrap gap-2 justify-center"></div>`;
            const optionsContainer = document.getElementById('live-chat-options');
            options.forEach(opt => {
                const button = document.createElement('button');
                button.textContent = opt.text;
                button.className = 'border border-color text-primary px-3 py-1 rounded-full text-sm hover:bg-secondary transition';
                button.onclick = () => handleLiveChatChoice(opt.value, opt.text);
                optionsContainer.appendChild(button);
            });
        };

        const showTextInput = (placeholder, callback) => {
            liveChatInput.innerHTML = `
                <div class="flex items-center space-x-2">
                    <input type="text" id="live-chat-text-input" placeholder="${placeholder}" class="form-input w-full p-2 border rounded-md bg-secondary text-primary">
                    <button id="live-chat-submit-btn" class="text-white px-4 py-2 rounded-md font-semibold" style="background-color: var(--accent-color);">Envoyer</button>
                </div>`;
            document.getElementById('live-chat-submit-btn').onclick = () => {
                const input = document.getElementById('live-chat-text-input');
                if (input.value) {
                    callback(input.value);
                }
            };
             document.getElementById('live-chat-text-input').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const input = document.getElementById('live-chat-text-input');
                     if (input.value) {
                        callback(input.value);
                    }
                }
            });
        };
        
        const handleLiveChatChoice = (value, text) => {
            addUserMessage(liveChatHistory, text);
            liveChatInput.innerHTML = '<p class="text-xs text-secondary text-center">Notre agent est en train d\'√©crire...</p>';

            setTimeout(() => {
                switch(value) {
                    case 'order_tracking':
                        addAgentMessage(liveChatHistory, "Bien s√ªr. Quel est votre num√©ro de commande ?");
                        showTextInput("Ex: 12345", (orderNumber) => {
                            addUserMessage(liveChatHistory, `Commande #${orderNumber}`);
                            liveChatInput.innerHTML = '<p class="text-xs text-secondary text-center">Notre agent v√©rifie...</p>';
                            setTimeout(() => {
                                addAgentMessage(liveChatHistory, `Votre commande #${orderNumber} est en cours de pr√©paration et sera exp√©di√©e demain. Merci de votre patience !`);
                                startLiveChat(false);
                            }, 1500);
                        });
                        break;
                    case 'product_question':
                         addAgentMessage(liveChatHistory, "Avec plaisir. Quel est le nom du produit qui vous int√©resse ?");
                         showTextInput("Ex: Robe d'√ât√© Florale", (productName) => {
                            addUserMessage(liveChatHistory, productName);
                             liveChatInput.innerHTML = '<p class="text-xs text-secondary text-center">Notre agent recherche...</p>';
                             setTimeout(() => {
                                const product = allProducts.find(p => p.name.toLowerCase().includes(productName.toLowerCase()));
                                if (product) {
                                    addAgentMessage(liveChatHistory, `Concernant la "${product.name}", nos tailles sont standard. Nous recommandons de prendre votre taille habituelle. Le tissu est de haute qualit√© et tr√®s confortable.`);
                                } else {
                                    addAgentMessage(liveChatHistory, "D√©sol√©, je n'ai pas trouv√© ce produit. Pouvez-vous v√©rifier le nom ?");
                                }
                                startLiveChat(false);
                            }, 1500);
                         });
                        break;
                    case 'shipping_info':
                        addAgentMessage(liveChatHistory, 'Nous livrons dans toute l\'Alg√©rie en 2 √† 5 jours. La livraison est gratuite d√®s 10 000 DZD d\'achat.');
                        startLiveChat(false);
                        break;
                    case 'human_agent':
                        addAgentMessage(liveChatHistory, "Bien s√ªr. Pour parler √† un conseiller, vous pouvez nous appeler au +213 555 111 222 pendant nos heures d'ouverture (9h-18h).");
                        startLiveChat(false);
                        break;
                }
            }, 1000);
        };
        
        const startLiveChat = (isFirstTime = true) => {
            if (isFirstTime) {
                liveChatHistory.innerHTML = '';
                setTimeout(() => {
                    addAgentMessage(liveChatHistory, 'Bonjour ! Comment puis-je vous aider aujourd\'hui ?');
                }, 500);
            }
            showLiveChatOptions([
                { text: 'Suivi de commande', value: 'order_tracking' },
                { text: 'Question sur un produit', value: 'product_question' },
                { text: 'Infos livraison', value: 'shipping_info' },
                { text: 'Parler √† un conseiller', value: 'human_agent' },
            ]);
        };

        document.getElementById('live-chat-cta').addEventListener('click', () => {
            modals['live-chat-modal'].open();
            startLiveChat();
        });

      // --- Recently Viewed ---
      let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
      const recentlyViewedContainer = document.getElementById('recently-viewed-container');
      const recentlyViewedSection = document.getElementById('recently-viewed-section');

      const renderRecentlyViewed = () => {
          if (recentlyViewed.length === 0) {
              recentlyViewedSection.classList.add('hidden');
              return;
          }
          recentlyViewedSection.classList.remove('hidden');
          recentlyViewedContainer.innerHTML = '';
          recentlyViewed.forEach(productId => {
              const product = allProducts.find(p => p.id === productId);
              if (product) {
                  const priceHTML = product.salePrice
                    ? `<span class="font-semibold" style="color:var(--accent-color)">${product.salePrice.toLocaleString('fr-FR')} DZD</span>`
                    : `<span class="font-semibold" style="color:var(--accent-color)">${product.price.toLocaleString('fr-FR')} DZD</span>`;
                  
                   const card = `
                    <div class="product-item bg-primary rounded-lg shadow-custom overflow-hidden flex flex-col w-64 flex-shrink-0" data-id="${product.id}">
                        <div class="relative overflow-hidden">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover">
                             <div class="product-hover-overlay !opacity-100 !transform-none !bg-transparent p-2 flex justify-end">
                                <button class="quick-view-btn w-auto bg-white/80 text-primary px-3 py-1 rounded-full text-xs font-semibold">Voir</button>
                            </div>
                        </div>
                        <div class="p-4 flex flex-col flex-grow">
                            <p class="product-name font-bold text-sm text-primary truncate">${product.name}</p>
                            <div class="product-price text-sm mt-1">${priceHTML}</div>
                        </div>
                    </div>`;
                    recentlyViewedContainer.innerHTML += card;
              }
          });
      };
      
      const addToRecentlyViewed = (productId) => {
          recentlyViewed = recentlyViewed.filter(id => id !== productId); // Remove if exists
          recentlyViewed.unshift(productId); // Add to the front
          if (recentlyViewed.length > 10) recentlyViewed.pop(); // Keep list size manageable
          localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
          renderRecentlyViewed();
      };


      // --- Social Proof Notification ---
      const socialProof = document.getElementById('social-proof');
      const showSocialProof = () => {
          if (!socialProof) return;
          const randomPurchase = allProducts[Math.floor(Math.random() * allProducts.length)];
          const locations = ["Constantine", "Alger", "Oran", "S√©tif"];
          const randomLocation = locations[Math.floor(Math.random() * locations.length)];
          socialProof.innerHTML = `
              <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-3"></i>
                  <div>
                      <p class="font-bold text-sm">Achat R√©cent</p>
                      <p class="text-xs text-secondary">Quelqu'un √† ${randomLocation} vient d'acheter <span class="font-semibold">${randomPurchase.name}</span></p>
                  </div>
              </div>
          `;
          socialProof.classList.remove('hidden');
          setTimeout(() => {
            socialProof.classList.remove('translate-y-20', 'opacity-0');
          }, 100);

          setTimeout(() => {
              socialProof.classList.add('translate-y-20', 'opacity-0');
               setTimeout(() => { socialProof.classList.add('hidden'); }, 500);
          }, 5000);
      };
      setInterval(showSocialProof, 12000);

      // --- Shop the Look ---
      const populateShopDots = (dots) => {
        dots.forEach(dot => {
            const product = allProducts.find(p => p.id === dot.productId);
            if(dot.el && product) {
              const finalPrice = product.salePrice || product.price;
              dot.el.innerHTML = `
                  <div data-id="${dot.productId}" class="relative">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-24 object-cover rounded-md mb-2">
                    <p class="product-name font-bold text-sm">${product.name}</p>
                    <p class="product-price text-xs" style="color:var(--accent-color)">${finalPrice.toLocaleString('fr-FR')} DZD</p>
                    <button class="add-to-cart-btn text-white text-xs px-2 py-1 rounded-full font-semibold mt-2 w-full" style="background-color: var(--accent-color);">Ajouter</button>
                  </div>
              `;
            }
        });
      };
      
      const lookbookDots = [
        { el: document.querySelector('.lookbook-item:first-child .shop-dot:nth-of-type(1) .dot-popup'), productId: 'P002' },
        { el: document.querySelector('.lookbook-item:first-child .shop-dot:nth-of-type(2) .dot-popup'), productId: 'P003' }
      ];
      const heroDots = [
        { el: document.querySelector('#hero-shop-dots .shop-dot:nth-of-type(1) .dot-popup'), productId: 'P005' },
        { el: document.querySelector('#hero-shop-dots .shop-dot:nth-of-type(2) .dot-popup'), productId: 'P004' }
      ];
      
      populateShopDots(lookbookDots);
      populateShopDots(heroDots);


      // --- Testimonial Slider ---
      const slides = document.querySelectorAll('.testimonial-slide');
      const prevBtn = document.querySelector('.testimonial-prev');
      const nextBtn = document.querySelector('.testimonial-next');
      let currentSlide = 0;

      function showSlide(n) {
          slides.forEach((slide, i) => slide.classList.toggle('active', i === n));
          currentSlide = n;
      }
      if(slides.length > 0) {
        nextBtn.addEventListener('click', () => showSlide((currentSlide + 1) % slides.length));
        prevBtn.addEventListener('click', () => showSlide((currentSlide - 1 + slides.length) % slides.length));
        setInterval(() => nextBtn.click(), 5000); // Auto-slide
      }

      // --- Countdown Timer ---
      const countdown = () => {
        if (!window.countDate) {
          const futureDate = new Date();
          futureDate.setDate(futureDate.getDate() + 7);
          window.countDate = futureDate.getTime();
        }

        const now = new Date().getTime();
        const gap = window.countDate - now;

        const second = 1000, minute = second * 60, hour = minute * 60, day = hour * 24;
        const textDay = Math.floor(gap / day), textHour = Math.floor((gap % day) / hour), textMinute = Math.floor((gap % hour) / minute), textSecond = Math.floor((gap % minute) / second);

        document.getElementById('days').innerText = textDay > 0 ? textDay : '0';
        document.getElementById('hours').innerText = textHour >= 0 ? textHour : '0';
        document.getElementById('minutes').innerText = textMinute >= 0 ? textMinute : '0';
        document.getElementById('seconds').innerText = textSecond >= 0 ? textSecond : '0';
      };
      setInterval(countdown, 1000);
      
      // --- Style Quiz ---
      const quizContent = document.getElementById('style-quiz-content');
      let quizAnswers = {};
      const quizData = [
          { question: "Quelle est votre destination de r√™ve ?", key: "destination", answers: [ { text: "Paris", image: "https://images.unsplash.com/photo-1522093007474-d86e9bf7ba6f?auto=format&fit=crop&q=60&w=500", value: "elegant" }, { text: "Bali", image: "https://images.unsplash.com/photo-1587542980590-a78ddb531733?auto=format&fit=crop&q=60&w=500", value: "casual" } ] },
          { question: "Choisissez une palette de couleurs :", key: "palette", answers: [ { text: "Nude & Neutres", image: "https://images.unsplash.com/photo-1543353384-850682a57da8?auto=format&fit=crop&q=60&w=500", value: "elegant" }, { text: "Vives & Color√©es", image: "https://images.unsplash.com/photo-1567401893414-76b7b1e5a7a5?auto=format&fit=crop&q=60&w=500", value: "casual" } ] },
      ];
      
      const showQuizQuestion = (index) => {
          if (index >= quizData.length) { showQuizResults(); return; }
          const q = quizData[index];
          quizContent.innerHTML = `<h3 class="text-xl font-semibold text-center mb-6 text-primary">${q.question}</h3><div class="grid grid-cols-2 gap-4">${q.answers.map(a => `<div class="quiz-answer-card cursor-pointer" data-key="${q.key}" data-value="${a.value}"><img src="${a.image}" class="w-full h-48 object-cover rounded-lg"><p class="text-center font-semibold mt-2 text-secondary">${a.text}</p></div>`).join('')}</div>`;
          document.querySelectorAll('.quiz-answer-card').forEach(card => card.addEventListener('click', () => { quizAnswers[card.dataset.key] = card.dataset.value; showQuizQuestion(index + 1); }));
      };

      const showQuizResults = () => {
          const elegantScore = Object.values(quizAnswers).filter(a => a === 'elegant').length;
          const resultStyle = elegantScore > Object.values(quizAnswers).length / 2 ? 'elegant' : 'casual';
          const resultTitle = resultStyle === 'elegant' ? 'L\'√âl√©gance Incarn√©e' : 'La Reine du D√©contract√©';
          const resultDesc = resultStyle === 'elegant' ? "Vous aimez les coupes structur√©es, les belles mati√®res et les pi√®ces intemporelles." : "Vous privil√©giez le confort sans sacrifier le style.";
          const recommendedProducts = allProducts.filter(p => p.style === resultStyle);
          quizContent.innerHTML = `<div class="text-center"><h3 class="text-3xl font-bold font-heading mb-2" style="color:var(--accent-color)">${resultTitle}</h3><p class="text-secondary mb-8">${resultDesc}</p><h4 class="text-xl font-bold font-heading mb-4 text-primary">Votre collection :</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">${recommendedProducts.slice(0, 2).map(p => `<div class="quiz-result-item bg-secondary rounded-lg p-3 flex items-center gap-4" data-id="${p.id}"><img src="${p.image}" class="w-20 h-24 object-cover rounded-md"/><div class="flex-grow"><p class="product-name font-bold text-sm text-primary">${p.name}</p><p class="product-price font-semibold text-xs" style="color:var(--accent-color)">${(p.salePrice || p.price).toLocaleString('fr-FR')} DZD</p><button class="add-to-cart-btn text-white text-xs px-3 py-1 rounded-full font-semibold mt-2" style="background-color: var(--accent-color);">Ajouter</button></div></div>`).join('')}</div><button id="restart-quiz" class="mt-8 text-secondary underline">Recommencer</button></div>`;
          document.getElementById('restart-quiz').addEventListener('click', () => showQuizQuestion(0));
      };
      window.style_quiz_modal_on_open = () => showQuizQuestion(0);
      
      // --- Gallery Lightbox ---
      const galleryItems = document.querySelectorAll('.gallery-item');
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      const lightboxClose = document.getElementById('lightbox-close');
      galleryItems.forEach(item => item.addEventListener('click', () => { lightboxImg.src = item.src; lightbox.classList.remove('opacity-0', 'pointer-events-none'); }));
      const closeLightbox = () => { lightbox.classList.add('opacity-0', 'pointer-events-none'); }
      lightboxClose.addEventListener('click', closeLightbox);
      lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });

      // --- Contact Form ---
      const contactForm = document.getElementById('contact-form');
      contactForm.addEventListener('submit', e => {
        e.preventDefault();
        const formStatus = document.getElementById('form-status');
        formStatus.textContent = 'Message envoy√© avec succ√®s !';
        formStatus.style.color = 'green';
        contactForm.reset();
        setTimeout(() => { formStatus.textContent = ''; }, 3000);
      });
      
      // --- Initial Calls ---
      updateDisplayedProducts();
      updateCart();
      updateWishlistButtons();
      renderRecentlyViewed();
    });
  </script>
</body>
</html>

